{% extends "layouts/base.html" %}

{% block title %} 실행 관리 {% endblock %}

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}

{% endblock stylesheets %}

{% block content %}
    {#         style="background-image: url('/static/assets/img/header-blue-purple.jpg'); background-position: bottom;"#}
    <div class="height-100"
         style="background-image: url('/static/assets/img/header-blue-purple.jpg'); background-position: bottom;"></div>
    <div class="container-fluid py-1 my-2">
        <div class="row mt-n7">
            <div class="col-lg-12">
                <div class="card blur border border-white rounded-2 shadow-xs">
                    <div class="card-body pb-2">
                        <div class="row">
                            <div class="col-lg-6 col-6 text-start">
                                <h4 class="text-dark font-weight-bold"><i class="fas fa-credit-card fas-4 me-3"></i>시행 관리</h4>
                            </div>
                            <div class="col-lg-6 col-6 text-end">
                                <!--<button type="button" class="btn btn-sm btn-primary text-white text-sm" id="btnSave" name="btnSave">저 장</button>-->
                                <!--<button type="button" class="btn btn-sm btn-linkedin text-white text-sm" id="btnClear" name="btnClear">초기화</button>-->
                                <button type="button" class="btn text-white text-sm ps-3 pe-3 pt-1 pb-1" style="background-color: darkorange; font-size: 0.8rem" id="btnDlt" name="btnDlt">
                                    <i class="fa fa-trash-arrow-up fs-6 pe-2"></i>취소</button>
                                <button type="button" class="btn text-white text-sm ps-3 pe-3 pt-1 pb-1" style="background-color: royalblue; font-size: 0.8rem" id="btnUpt" name="btnUpt">
                                    <i class="fa fa-cloud-arrow-up fs-6 pe-2"></i>수정</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-6 col-6">
                <div class="card border border-white shadow-xs">
                    <div class="card-header height-200 pb-0">
                        <div class="row p-0 pb-0">
                            <div hidden class="col-lg-4 col-4">
                                <div class="input-group shadow-none">
                                    <label class="me-3" style="font-size: 0.85rem; width: 5rem"><i class="fa fa-search me-2"></i>거래일자</label>
                                    <input class="form-control border border-light rounded-1 text-center me-2 w-20" type="date" name="inputDate" id="inputDate" style="height: 2rem; width: 10rem">
                                </div>
                            </div>
                            <div class="col-lg-3 col-3">
                                <div class="input-group shadow-none">
                                    <label class="me-3" style="font-size: 0.85rem; width: 5rem"><i class="fa fa-search me-2"></i>시행</label>
                                    <select class="form-control border border-light rounded-1 text-center p-1 w-20" name="inputPermit" id="inputPermit" style="height: 2rem; font-size: 0.8rem">
                                        <option value="">미시행</option>
                                        <option value="1">시행</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-lg-6 col-6 text-end"></div>
                            <div class="col-lg-3 col-3 text-end">
                                <button type="button" class="btn btn-sm btn-primary text-white" style="font-size: 0.8rem" id="btnSearch" name="btnSearch">
                                        <i class="fa fa-search me-2 fs-6"></i>조 회
                                </button>
                            </div>
                        </div>
                        <div class="row p-0 pt-0">
                            <div class="col-lg-7 col-7">
                                <div class="input-group shadow-none">
                                    <label class="me-3" style="font-size: 0.85rem; width: 5rem"><i class="fas fa-search me-2"></i>일 자</label>
                                    <input class="form-control border border-light rounded-1 text-center me-2 w-20" type="date" name="strDate" id="strDate" style="height: 2rem; width: 10rem">
                                    <label class="p-0" style="font-size: 0.85rem; width: 1rem">-</label>
                                    <input class="form-control border border-light rounded-1 text-center w-20" type="date" name="endDate" id="endDate" style="height: 2rem; width: 10rem">
                                </div>
                            </div>
                            <div class="col-lg-5 col-5">
                                <div class="input-group shadow-none">
                                    <label class="me-3" style="font-size: 0.85rem; width: 7rem"><i class="fa fa-search me-2"></i>거래처/사용처</label>
                                    <input hidden class="form-control border border-light rounded-1 text-center me-2" type="text" name="txtCustCode" id="txtCustCode" style="height: 2rem; max-width: 12rem">
                                    <input class="form-control border border-light rounded-1 text-center me-2" type="text" name="txtCust" id="txtCust" style="height: 2rem; max-width: 16rem">
                                </div>
                            </div>
                        </div>
                        <div class="row p-0 mt-2">
                            <div class="col-lg-4 col-4">
                                <div class="input-group shadow-none">
                                    <label class="me-3" style="font-size: 0.85rem; width: 5rem"><i class="fas fa-search me-2"></i>카드명</label>
                                    <select class="form-control border border-light rounded-1 text-center p-1 w-20" name="inputCard" id="inputCard" style="height: 2rem; font-size: 0.8rem"></select>
                                </div>
                            </div>
                            <div class="col-lg-4 col-4">
                                <div class="input-group shadow-none">
                                    <label class="me-3" style="font-size: 0.85rem; width: 5rem"><i class="fas fa-search me-2"></i>카드번호</label>
                                    <select class="form-control border border-light rounded-1 text-center p-1 w-20" name="inputCardNum" id="inputCardNum" style="height: 2rem; font-size: 0.8rem"></select>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-2 p-0">
                            <div class="col-lg-4 col-4">
                                <div class="input-group shadow-none">
                                    <label class="me-3" style="font-size: 0.85rem; width: 5rem"><i class="fas fa-search me-2"></i>은행명</label>
                                    <select class="form-control border border-light rounded-1 text-center p-1 w-20" name="inputBank" id="inputBank" style="height: 2rem; font-size: 0.8rem"></select>
                                </div>
                            </div>
                            <div class="col-lg-4 col-4">
                                <div class="input-group shadow-none">
                                    <label class="me-3" style="font-size: 0.85rem; width: 5rem"><i class="fas fa-search me-2"></i>계좌번호</label>
                                    <select class="form-control border border-light rounded-1 text-center p-1 w-20" name="inputAct" id="inputAct" style="height: 2rem; font-size: 0.8rem"></select>
                                </div>
                            </div>
                            <div class="col-lg-4 col-4">

                            </div>
                            <div hidden class="col-lg-2 col-2">
                                <label class="me-3" style="font-size: 0.85rem; width: 5rem" id="offLabel"></label>
                            </div>
                        </div>
                    </div>
                    <div class="card-body mt-0 pt-1">
                        <div class="table-responsive-sm height-600 overflow-auto border border-light">
                            <table class="table mb-0 align-items-center justify-content-center" id="selectTb">

                                <thead class="text-white font-weight-bolder text-center" style="background-color: darkslateblue; position: sticky; top: 0; z-index: 1;">
                                <tr>
                                    <th style="font-size: 0.85rem" class="p-1">선택</th>
                                    <th style="font-size: 0.85rem" class="p-1">사용일자</th>
                                    <th style="font-size: 0.85rem" class="p-1">적용년월</th>
                                    <th style="font-size: 0.85rem" class="p-1">제 목</th>
                                    <th style="font-size: 0.85rem" class="p-1">거래처/사용처</th>
                                    <th style="font-size: 0.85rem" class="p-1">전표 금액</th>
                                    <th style="font-size: 0.85rem" class="p-1">기결 금액</th>
                                    <th style="font-size: 0.85rem" class="p-1">잔 액</th>
                                    <th style="font-size: 0.85rem" class="p-1">작성자</th>
                                    <!--<th style="font-size: 0.85rem; position: sticky; left: 0; background: darkslateblue;" class="p-1 perTh">선 택</th>
                                    <th hidden style="font-size: 0.85rem; position: sticky; left: calc(4% - 5px); background: darkslateblue;" class="p-1 apvTh">상계</th>
                                    <th style="font-size: 0.85rem; position: sticky; left: 35px; background: darkslateblue;" class="p-1">등록일자</th>
                                    <th style="font-size: 0.85rem; position: sticky; left: 114px; background: darkslateblue;" class="p-1">예정일자</th>
                                    <th style="font-size: 0.85rem" class="p-1">제 목</th>
                                    <th style="font-size: 0.85rem" class="p-1">계정 과목</th>
                                    <th style="font-size: 0.85rem" class="p-1">은 행</th>
                                    <th style="font-size: 0.85rem" class="p-1">계좌번호</th>
                                    <th style="font-size: 0.85rem" class="p-1">전표금액</th>
                                    <th style="font-size: 0.85rem" class="p-1">기결재액</th>
                                    <th style="font-size: 0.85rem" class="p-1">잔 액</th>
                                    <th style="font-size: 0.85rem" class="p-1">작성자</th>
                                    <th style="font-size: 0.85rem" class="p-1">지급정보</th>-->
                                </tr>
                                </thead>
                                <tbody id="mainTb">
                                <tr id="#mainTr" class="mainTr_tr">

                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="row mt-2">
                            <div class="col-lg-5 col-5"></div>
                            <div class="col-lg-7 col-7">
                                <div class="d-flex" style="float: right">
                                    <label style="font-size: 0.85rem; width: 3rem"><i class="fa fa-server me-2"></i>총</label>
                                    <input readonly class="form-control border border-light rounded-1 text-end me-2" type="text" name="inputCnt" id="inputCnt" style="font-size: 0.8rem; height: 2rem; max-width: 4rem">
                                    <label class="me-4" style="font-size: 0.85rem; width: 1rem">건</label>
                                    <label class="me-3" style="font-size: 0.85rem"><i class="ni ni-money-coins me-2"></i>합계 금액</label>
                                    <input readonly class="form-control border border-light rounded-1 text-end" type="text" name="inputPrice" id="inputPrice" style="height: 2rem; width: 10rem">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 col-6">
                <div class="card border border-white shadow-xs">
                    <div class="card-header height-150 pb-0">
                        <div class="row p-0">
                            <div class="col-lg-4 col-4">
                                <div class="input-group shadow-none">
                                    <label class="me-3" style="font-size: 0.85rem; width: 5rem"><i class="fa fa-circle-exclamation me-2"></i>이체 구분</label>
                                    <!--<button class="btn btn-sm btn-white font-weight-bold" style="background-color: #a193be" id="cboTransGbn" name="cboTransGbn">시행</button>-->
                                    <select class="form-control border border-light rounded-1 text-center p-1 font-weight-bold" name="cboTransGbn" id="cboTransGbn" style="height: 2rem; font-size: 0.8rem; max-width: 10rem; background-color: #cdc5dd">
                                        <option value="1" selected>시행</option>
                                        <option value="2">상계</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-lg-4 col-4">
                                <div class="input-group shadow-none sange">
                                    <label class="me-3" style="font-size: 0.85rem; width: 5rem"><i
                                            class="fa fa-file-invoice me-2"></i>상계 금액</label>
                                    <input class="form-control border border-light rounded-1 text-end me-2 w-20"
                                           type="text" name="CostOffSet" id="CostOffSet"
                                           style="height: 2rem; width: 10rem">
                                    <input type="hidden" id="real_CostOffSet" value="0" />
                                </div>
                            </div>
                            <div class="col-lg-4 col-4 text-end">
                                <button type="button" class="btn btn-sm text-white font-weight-bolder" style="background-color: seagreen; font-size: 0.8rem" id="btnPermit" name="btnPermit">
                                    <i class="fas fa-file-signature me-2 fs-6"></i>등록
                                </button>
                            </div>
                        </div>
                        <div class="row p-0">
                            <div class="col-lg-4 col-4">
                                <div class="input-group shadow-none">
                                    <label class="me-3" style="font-size: 0.85rem; width: 5rem"><i class="ni ni-calendar-grid-58 me-2"></i>시행 일자</label>
                                    <input class="form-control border border-light rounded-1 text-center me-2 w-20" type="date" name="permitDate" id="permitDate" style="height: 2rem; width: 10rem">
                                </div>
                            </div>
                            <div class="col-lg-4 col-4">
                                <div class="input-group shadow-none">
                                    <label class="me-3" style="font-size: 0.85rem; width: 5rem"><i class="fa fa-file-invoice me-2"></i>은행명</label>
                                    <select class="form-control border border-light rounded-1 text-center p-1 w-20" name="actBank" id="actBank" style="height: 2rem; font-size: 0.8rem"></select>
                                </div>
                            </div>
                            <div class="col-lg-4 col-4">
                                <div class="input-group shadow-none">
                                    <label class="me-3" style="font-size: 0.85rem; width: 5rem"><i class="fa fa-file-invoice me-2"></i>계좌 번호</label>
                                    <select class="form-control border border-light rounded-1 text-center p-1 w-20" name="actNumber" id="actNumber" style="height: 2rem; font-size: 0.8rem"></select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body mt-0 pt-1">
                        <div class="table-responsive-sm overflow-auto border border-light height-600">
                            <table class="table mb-0 align-items-center justify-content-center" id="chkTb">
                                <colgroup>
                                    <col width="8%">
                                    <col width="15%">
                                    <col width="6%">
                                    <col width="6%">
                                    <col hidden width="6%">
                                    <col width="6%">
                                    <col hidden width="10%">
                                    <col hidden width="6%">
                                </colgroup>
                                <thead class="text-white font-weight-bolder text-center"
                                       style="background-color: darkgreen; position: sticky; top: 0">
                                <tr>
                                    <th style="font-size: 0.85rem" class="p-1">시행일자</th>
                                    <th style="font-size: 0.85rem" class="p-1">제 목</th>
                                    <th style="font-size: 0.85rem" class="p-1">계정과목</th>
                                    <th style="font-size: 0.85rem" class="p-1">지출금액</th>
                                    <th style="font-size: 0.85rem" class="p-1">작성자</th>
                                </tr>
                                </thead>
                                <tbody id="subTb">
                                <tr id="subTr" class="subTr_tr">

                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="row mt-2">
                            <div class="col-lg-5 col-5"></div>
                            <div class="col-lg-7 col-7">
                                <div class="d-flex" style="float: right">
                                    <label style="font-size: 0.85rem; width: 3rem"><i class="fa fa-server me-2"></i>총</label>
                                    <input readonly class="form-control border border-light rounded-1 text-end me-2" type="text" name="inputCnt2" id="inputCnt2" style="font-size: 0.8rem; height: 2rem; max-width: 4rem">
                                    <label class="me-4" style="font-size: 0.85rem; width: 1rem">건</label>
                                    <label class="me-3" style="font-size: 0.85rem"><i class="ni ni-money-coins me-2"></i>합계 금액</label>
                                    <input readonly class="form-control border border-light rounded-1 text-end" type="text" name="inputPrice2" id="inputPrice2" style="height: 2rem; width: 10rem">
                                    <input type="hidden" id="real_CostOffSet2" value="0" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



{% endblock %}

{% block javascripts %}
    <script>
        $(document).ready(function () {

            var balance = 0;
            var inputBank = "";
            var inputAct = "";
            var inputCard = "";
            var inputCardNum = "";
            var actNumber = "";
            var actBank = "";
            var inputBankTxt = "<option value=''>:: 선택 ::</option>";
            var inputActTxt = "<option value=''>:: 선택 ::</option>";
            var inputCardTxt = "<option value=''>:: 선택 ::</option>";
            var inputCardNumTxt = "<option value=''>:: 선택 ::</option>";
            var actNumberTxt = "<option value=''>:: 선택 ::</option>";
            var actBankTxt = "<option value=''>:: 선택 ::</option>";

            $("#inputBank").html("");
            $("#inputAct").html("");
            $("#inputCard").html("");
            $("#inputCardNum").html("");
            $("#actNumber").html("");
            $("#actBank").html("");

            var date = new Date();
            date.setMonth(date.getMonth() - 3);

            document.getElementById('strDate').valueAsDate = date;
            document.getElementById('endDate').valueAsDate = new Date
            document.getElementById('permitDate').valueAsDate = new Date

            var strDate = document.getElementById('strDate').value
            var endDate = document.getElementById('endDate').value
            var pDate = document.getElementById('inputDate').value
            var perDate = pDate.replace(/\-/g, '')

            var custCode = "";
            var offSet = "";
            var permitGbn = "";
            var bankCode = "";
            var actCode = "";


            let data = {"strDate": strDate, "endDate": endDate, "perDate": perDate, "custCode": custCode, "offSet": offSet, "permitGbn": permitGbn, "bankCode": bankCode, "actCode": actCode, "inputCard": inputCard, "inputCardNum": inputCardNum}

            $.ajax({
                type: "post",
                data: data,
                url: '{% url "permit_reg_search" %}',
                headers: {
                    'X-CSRFTOKEN': '{{ csrf_token }}'
                },
                dataType: 'json',
                success: function (data) {
                    var list = data.mainList;
                    var count = 0;
                    var total = 0;
                    var cust = "";

                    {#"<td class='text-center p-1' style='font-size: 0.85rem; position: sticky; left: calc(4% - 5px); background: white;'><input class='chkSetOff' type='checkbox' id='chkSetOff_" + i + "' name='chkSetOff[]' value=''/></td> " +#}
                    count = list.length;
                    {# 순번, 입.출금구분, 날짜 #}
                    $("#mainTb").html("");
                    for (var i = 0; i < list.length; i++) {

                        balance = parseInt(list[i][2]) - parseInt(list[i][16])
                        if(list[i][19] != ''){ cust = list[i][20] }
                        if(list[i][21] != ''){ cust = list[i][21]}


                        $("#mainTb").append(
                            "<tr id='#mainTr' class='mainTr_tr'>" +
                            "<td class='text-center p-1' style='font-size: 0.85rem; position: sticky; left: 0; background: white;'><input class='chkPer' type='checkbox' id='chkPer[]' name='chkPer[]' value=''/></td> " +
                            "<td class='text-center p-1' style='font-size: 0.85rem; position: sticky; left: 35px; background: white;'>" + list[i][0].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3') + "</td> " +
                            "<td class='text-center p-1' style='font-size: 0.85rem; position: sticky; left: 114px; background: white;'>" + list[i][18].replace(/(\d{4})(\d{2})/g, '$1-$2') + "</td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'>" + list[i][1] + "</td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'>" + cust + "</td> " +
                            "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(list[i][2]) + "</td> " +
                            "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(list[i][16]) + "</td> " +
                            "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(balance) + "</td> " +
                            "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][3] + "</td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'>" + list[i][4] + "</td> " +
                            "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][0] + "</td> " +
                            "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][5] + "</td> " +
                            "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][6] + "</td> " +
                            "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][7] + "</td> " +
                            "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][15] + "</td> " +
                            "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][12] + "</td> " +
                            "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][9] + "</td> " +
                            "</tr> ");

                        total += parseInt(list[i][2])
                    }
                    document.getElementById('inputCnt').value = addComma(count)
                    document.getElementById('inputPrice').value = addComma(total)

                    var combolist2 = data.cboAct;
                    for (var i = 0; i < combolist2.length; i++) {
                        if (combolist2[i][0] == actNumber) {
                            actNumberTxt = actNumberTxt + "<option value='" + combolist2[i][0] + "' selected>" + combolist2[i][0] + "</option>";
                        } else {
                            actNumberTxt = actNumberTxt + "<option value='" + combolist2[i][0] + "'>" + combolist2[i][0] + "</option>";
                        }
                    }

                    var combolist3 = data.cboBank;
                    for (var i = 0; i < combolist3.length; i++) {
                        if (combolist3[i][0] == inputBank) {
                            inputBankTxt = inputBankTxt + "<option value='" + combolist3[i][0] + "' selected>" + combolist3[i][1] + "</option>";
                        } else {
                            inputBankTxt = inputBankTxt + "<option value='" + combolist3[i][0] + "'>" + combolist3[i][1] + "</option>";
                        }
                    }

                    var combolist4 = data.cboAct;
                    for (var i = 0; i < combolist4.length; i++) {
                        if (combolist4[i][0] == inputAct) {
                            inputActTxt = inputActTxt + "<option value='" + combolist4[i][0] + "' selected>" + combolist4[i][0] + "</option>";
                        } else {
                            inputActTxt = inputActTxt + "<option value='" + combolist4[i][0] + "'>" + combolist4[i][0] + "</option>";
                        }
                    }

                    var combolist5 = data.cboCard;
                    for (var i = 0; i < combolist5.length; i++) {
                        if (combolist5[i][0] == inputCard) {
                            inputCardTxt = inputCardTxt + "<option value='" + combolist5[i][0] + "' selected>" + combolist5[i][1] + "</option>";
                        } else {
                            inputCardTxt = inputCardTxt + "<option value='" + combolist5[i][0] + "'>" + combolist5[i][1] + "</option>";
                        }
                    }

                    var combolist6 = data.cboCardNum;
                    for (var i = 0; i < combolist6.length; i++) {
                        if (combolist6[i][0] == inputCardNum) {
                            inputCardNumTxt = inputCardNumTxt + "<option value='" + combolist6[i][0] + "' selected>" + combolist6[i][0] + "</option>";
                        } else {
                            inputCardNumTxt = inputCardNumTxt + "<option value='" + combolist6[i][0] + "'>" + combolist6[i][0] + "</option>";
                        }
                    }

                    var combolist7 = data.cboBank;
                    for (var i = 0; i < combolist7.length; i++) {
                        if (combolist7[i][0] == actBank) {
                            actBankTxt = actBankTxt + "<option value='" + combolist7[i][0] + "' selected>" + combolist7[i][1] + "</option>";
                        } else {
                            actBankTxt = actBankTxt + "<option value='" + combolist7[i][0] + "'>" + combolist7[i][1] + "</option>";
                        }
                    }

                    $("#actNumber").append(actNumberTxt);
                    $("#inputBank").append(inputBankTxt);
                    $("#inputAct").append(inputActTxt);
                    $("#inputCard").append(inputCardTxt);
                    $("#inputCardNum").append(inputCardNumTxt);
                    $("#actBank").append(actBankTxt);
                }
            })
        });

        $('input[type="text"]').keydown(function (event) {
            if (event.keyCode === 13) {
                event.preventDefault();
                if (event.currentTarget.id === 'txtCust') {

                    if ($("#txtCust").val().length == 0) {
                        alert("거래처명 한 글자 이상 입력 후 엔터를 쳐주세요.")
                        return false
                    } else {
                        let thisVal = $("#txtCust").val();
                        let gbnVal = '2';
                        let url = '{% url 'popup_cust' %}';
                        openPop(url + '?val=' + thisVal + '&gbnVal=' + gbnVal, '거래처검색창');
                    }

                }
            }
        });


        {# 조회 버튼 #}
        $(document).on('click', "#btnSearch", function () {

            var total = 0;
            var balance = 0;
            var cust = "";

            var strDate = document.getElementById('strDate').value;
            var endDate = document.getElementById('endDate').value;
            //var perDate = sDate.replace(/\-/g, '')
            var txtCustCode = document.getElementById('txtCustCode').value;
            var custCode = document.getElementById('txtCust').value;
            if(txtCustCode != ''){ custCode = txtCustCode; }
            var offSet = $('input[name=inputOffSet]:checked').val();
            var permitGbn = document.getElementById('inputPermit').value;
            var bankCode = document.getElementById('inputBank').value;
            var actCode = document.getElementById('inputAct').value;
            var inputCard = document.getElementById('inputCard').value;
            var inputCardNum = document.getElementById('inputCardNum').value;

            if(inputCard != '' && inputCardNum == ''){
                alert('카드번호를 선택해주세요.')
                return false
            }
            if(bankCode != '' && actCode == ''){
                alert('계좌번호를 선택해주세요.')
                return false
            }

            let data = {"strDate": strDate, "endDate": endDate, "custCode": custCode, "offSet": offSet, "permitGbn": permitGbn, "bankCode": bankCode, "actCode": actCode, "inputCard": inputCard, "inputCardNum": inputCardNum}

            $.ajax({
                type: "post",
                data: data,
                url: '{% url "permit_reg_search" %}',
                headers: {
                    'X-CSRFTOKEN': '{{ csrf_token }}'
                },
                dataType: 'json',
                success: function (data) {
                    var list = data.mainList;

                    {# 순번, 입.출금구분, 날짜 #}
                    $("#mainTb").html("");
                    if(permitGbn == ''){
                        for (var i = 0; i < list.length; i++) {

                            balance = parseInt(list[i][2]) - parseInt(list[i][16])
                            if(list[i][19] != ''){ cust = list[i][20] }
                            if(list[i][21] != ''){ cust = list[i][21]}

                            $("#mainTb").append(
                                "<tr id='#mainTr' class='mainTr_tr'>" +
                                "<td class='text-center p-1' style='font-size: 0.85rem; position: sticky; left: 0; background: white;'><input class='chkPer' type='checkbox' id='chkPer[]' name='chkPer[]' value=''/></td> " +
                                "<td class='text-center p-1' style='font-size: 0.85rem; position: sticky; left: 35px; background: white;'>" + list[i][0].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3') + "</td> " +
                                "<td class='text-center p-1' style='font-size: 0.85rem; position: sticky; left: 114px; background: white;'>" + list[i][18].replace(/(\d{4})(\d{2})/g, '$1-$2') + "</td> " +
                                "<td class='text-start p-1' style='font-size: 0.85rem'>" + list[i][1] + "</td> " +
                                "<td class='text-start p-1' style='font-size: 0.85rem'>" + cust + "</td> " +
                                "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(list[i][2]) + "</td> " +
                                "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(list[i][16]) + "</td> " +
                                "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(balance) + "</td> " +
                                "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][3] + "</td> " +
                                "<td class='text-start p-1' style='font-size: 0.85rem'>" + list[i][4] + "</td> " +
                                "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][0] + "</td> " +
                                "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][5] + "</td> " +
                                "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][6] + "</td> " +
                                "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][7] + "</td> " +
                                "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][15] + "</td> " +
                                "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][12] + "</td> " +
                                "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][9] + "</td> " +
                                "</tr> ");

                            //hidden: 날짜, 순번, 입출금, 코드, 결재구분, 은행코드, 계좌번호

                            total += parseInt(list[i][2])
                        }
                    }
                    if(permitGbn == '1'){
                        for (var i = 0; i < list.length; i++) {

                            balance = parseInt(list[i][8]) - parseInt(list[i][9])
                            if(list[i][5] != ''){ cust = list[i][6] }
                            if(list[i][7] != ''){ cust = list[i][7]}

                            $("#mainTb").append(
                                "<tr id='#mainTr' class='mainTr_tr'>" +
                                "<td class='text-center p-1' style='font-size: 0.85rem; position: sticky; left: 0; background: white;'><input class='chkPer' type='checkbox' id='chkPer[]' name='chkPer[]' value=''/></td> " +
                                "<td class='text-center p-1' style='font-size: 0.85rem; position: sticky; left: 35px; background: white;'>" + list[i][0].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3') + "</td> " +
                                "<td class='text-center p-1' style='font-size: 0.85rem; position: sticky; left: 114px; background: white;'>" + list[i][3].replace(/(\d{4})(\d{2})/g, '$1-$2') + "</td> " +
                                "<td class='text-start p-1' style='font-size: 0.85rem'>" + list[i][4] + "</td> " +
                                "<td class='text-start p-1' style='font-size: 0.85rem'>" + cust + "</td> " +
                                "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(list[i][8]) + "</td> " +
                                "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(list[i][9]) + "</td> " +
                                "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(balance) + "</td> " +
                                "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][10] + "</td> " +
                                "<td class='text-start p-1' style='font-size: 0.85rem'>" + list[i][11] + "</td> " +
                                "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][0] + "</td> " +
                                "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][1] + "</td> " +
                                "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][2] + "</td> " +
                                "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][13] + "</td> " +
                                "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][20] + "</td> " +
                                "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][18] + "</td> " +
                                "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][17] + "</td> " +
                                "</tr> ");

                            //hidden: 날짜, 순번, 입출금, 코드, 결재구분, 은행코드, 계좌번호

                            total += parseInt(list[i][8])
                        }
                    }
                    document.getElementById('inputPrice').value = addComma(total)
                }
            })
        });

        {# 미시행선택하고 왼쪽 테이블에 체크박스 체크했는데, 시행으로 콤보박스 바꾸면 오른쪽 테이블 내용 지워지고 왼쪽 테이블 체크박스 빠져야함. #}
        $('#inputPermit').change(function () {
            $("#subTb").html("");
            var count = $('#selectTb').closest('tr').prevAll().length;
            $('#mainTr' + count).remove();
        });

        {# 결제방법 선택시 계좌명 바인딩 #}
        $('#inputCard').change(function () {
            var inputCardNum = "";
            var inputCardNumTxt = "<option value=''>:: 선택 ::</option>";

            $("#inputCardNum").html("");

            var cboCard = document.getElementById('inputCard').value

            var data = {"cboCard": cboCard}

            $.ajax({
                type: "post",
                url: '{% url "cboCardNum" %}',
                data: data,
                headers: {
                    'X-CSRFTOKEN': '{{ csrf_token }}'
                },
                dataType: 'json',
                success: function (data) {

                    var combolist = data.cboCardNum;
                    for (var i = 0; i < combolist.length; i++) {
                        if (combolist[i][0] == inputCardNum) {
                            inputCardNumTxt = inputCardNumTxt + "<option value='" + combolist[i][0] + "' selected>" + combolist[i][0] + "</option>";
                        } else {
                            inputCardNumTxt = inputCardNumTxt + "<option value='" + combolist[i][0] + "'>" + combolist[i][0] + "</option>";
                        }
                    }

                    $("#inputCardNum").append(inputCardNumTxt);
                }
            });
        });

        {# 결제방법 선택시 계좌명 바인딩 #}
        $('#inputBank').change(function () {
            var inputAct = "";
            var inputActTxt = "<option value=''>:: 선택 ::</option>";

            $("#inputAct").html("");

            var cboBank = document.getElementById('inputBank').value

            var data = {"cboBank": cboBank}

            $.ajax({
                type: "post",
                url: '{% url "cboAct" %}',
                data: data,
                headers: {
                    'X-CSRFTOKEN': '{{ csrf_token }}'
                },
                dataType: 'json',
                success: function (data) {

                    var combolist5 = data.cboAct;
                    for (var i = 0; i < combolist5.length; i++) {
                        if (combolist5[i][0] == inputAct) {
                            inputActTxt = inputActTxt + "<option value='" + combolist5[i][0] + "' selected>" + combolist5[i][0] + "</option>";
                        } else {
                            inputActTxt = inputActTxt + "<option value='" + combolist5[i][0] + "'>" + combolist5[i][0] + "</option>";
                        }
                    }

                    $("#inputAct").append(inputActTxt);
                }
            });
        });

        {# 은행 선택시 계좌명 바인딩 #}
        $('#actBank').change(function () {
            var actNumber = "";
            var actNumberTxt = "<option value=''>:: 선택 ::</option>";

            $("#actNumber").html("");

            var cboBank = document.getElementById('actBank').value

            var data = {"cboBank": cboBank}

            $.ajax({
                type: "post",
                url: '{% url "cboAct" %}',
                data: data,
                headers: {
                    'X-CSRFTOKEN': '{{ csrf_token }}'
                },
                dataType: 'json',
                success: function (data) {

                    var combolist5 = data.cboAct;
                    for (var i = 0; i < combolist5.length; i++) {
                        if (combolist5[i][0] == actNumber) {
                            actNumberTxt = actNumberTxt + "<option value='" + combolist5[i][0] + "' selected>" + combolist5[i][0] + "</option>";
                        } else {
                            actNumberTxt = actNumberTxt + "<option value='" + combolist5[i][0] + "'>" + combolist5[i][0] + "</option>";
                        }
                    }

                    $("#actNumber").append(actNumberTxt);
                }
            });
        });





        {# 상계 체크박스 선택시 #}
{#        $(document).on('change', '#selectTb tbody tr td input.chkSetOff', function () {#}
{#            var tr = $(this).parent().parent();#}
{#            var aDate = tr.children().eq(1).text()#}
{#            var acDate = aDate.replace(/\-/g, '')#}
{#            var acTitle = tr.children().eq(3).text()#}
{#            var acCust = tr.children().eq(4).text()#}
{#            var acMcode = tr.children().eq(13).text()#}
{#            var acBank = tr.children().eq(15).text()#}
{#            var acNum = tr.children().eq(16).text()#}
{#            var acEmp = tr.children().eq(8).text()#}
{#            var acNme = tr.children().eq(9).text()#}
{#            var acSeqn = tr.children().eq(11).text()#}
{#            var acIogb = tr.children().eq(12).text()#}
{#            var acGubn = tr.children().eq(14).text()#}
{#            var iDate = tr.children().eq(10).text()#}
{#            var ioDate = iDate.replace(/\-/g, '')#}
{##}
{#            var acAmts = tr.children().eq(5).text().replace(/\,/g, '')#}
{#            var finAmts = tr.children().eq(6).text().replace(/\,/g, '')#}
{#            var balance = tr.children().eq(7).text().replace(/\,/g, '')#}
{##}
{##}
{#            var count = $(this).closest('tr').prevAll().length;#}
{##}
{#            var offTotal = 0;#}
{##}
{#            var offSet = $('input[name=inputOffSet]:checked').val();#}
{##}
{#            var isChkPerChecked = tr.find('input.chkPer').is(':checked');#}
{##}
{#            var pDate = document.getElementById('permitDate').value#}
{#            var perDate = pDate.replace(/\-/g, '')#}
{##}
{#            var cboBank = "";#}
{#            var cboActNum = "";#}
{#            var cboMcode = "";#}
{#            var cboActNumTxt = "<option value=''>:: 선택 ::</option>";#}
{#            var cboBankTxt = "<option value=''>:: 선택 ::</option>";#}
{#            var cboMcodeTxt = "<option value=''>:: 선택 ::</option>";#}
{##}
{#            $("#cboActNum_"+count).html("");#}
{#            $("#cboBank_"+count).html("");#}
{#            $("#cboMcode_"+count).html("");#}
{##}
{#            let data = {"acIogb": acIogb}#}
{##}
{#            $.ajax({#}
{#                type: "post",#}
{#                data: data,#}
{#                url: '{% url "permit_cbo_search" %}',#}
{#                headers: {#}
{#                    'X-CSRFTOKEN': '{{ csrf_token }}'#}
{#                },#}
{#                dataType: 'json',#}
{#                success: function (data) {#}
{#                    var combolist = data.cboActNum;#}
{#                    for (var i = 0; i < combolist.length; i++) {#}
{#                        if (combolist[i][0] == acNum) {#}
{#                            cboActNumTxt = cboActNumTxt + "<option value='" + combolist[i][0] + "' selected>" + combolist[i][0] + "</option>";#}
{#                        } else {#}
{#                            cboActNumTxt = cboActNumTxt + "<option value='" + combolist[i][0] + "'>" + combolist[i][0] + "</option>";#}
{#                        }#}
{#                    }#}
{##}
{#                    var combolist2 = data.cboBank;#}
{#                    for (var i = 0; i < combolist2.length; i++) {#}
{#                        if (combolist2[i][0] == acBank) {#}
{#                            cboBankTxt = cboBankTxt + "<option value='" + combolist2[i][0] + "' selected>" + combolist2[i][1] + "</option>";#}
{#                        } else {#}
{#                            cboBankTxt = cboBankTxt + "<option value='" + combolist2[i][0] + "'>" + combolist2[i][1] + "</option>";#}
{#                        }#}
{#                    }#}
{##}
{#                    var combolist3 = data.cboMcode;#}
{#                    for (var i = 0; i < combolist3.length; i++) {#}
{#                        if (combolist3[i][0] == acMcode) {#}
{#                            cboMcodeTxt = cboMcodeTxt + "<option value='" + combolist3[i][0] + "' selected>" + combolist3[i][1] + "</option>";#}
{#                        } else {#}
{#                            cboMcodeTxt = cboMcodeTxt + "<option value='" + combolist3[i][0] + "'>" + combolist3[i][1] + "</option>";#}
{#                        }#}
{#                    }#}
{##}
{#                    $("#cboBank_"+count).append(cboBankTxt);#}
{#                    $("#cboActNum_"+count).append(cboActNumTxt);#}
{#                    $("#cboMcode_"+count).append(cboMcodeTxt);#}
{#                }#}
{#            })#}
{##}
{##}
{#            var total = 0;#}
{#            if ($(this).is(':checked')) {#}
{##}
{#                if ($('#subTr' + count).length == 0) {#}
{##}
{#                    var sub_tr_cnt = $('#chkTb tbody tr').length;#}
{##}
{#                    $("#subTb").append(#}
{#                        "<tr id='subTr" + count + "' class='subTr_tr'>" +#}
{#                        "<td class='text-center p-1' name='perDate'  id='perDate_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + perDate.replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3') + "</td>" +#}
{#                        "<td hidden class='text-center p-1' name='ioDate'  id='ioDate_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + ioDate + "</td>" +#}
{#                        "<td class='text-start p-1' id='acTitle_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acTitle + "</td> " +#}
{#                        "<td class='text-start p-1' name='mCode'  id='mCode_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" +#}
{#                        "<select style='height: 2rem; font-size: 0.8rem' class='form-control border border-light rounded-1 text-center p-1' id='cboMcode_" + count + "' name='cboMcode'></select></td> " +#}
{#                        "<td hidden class='text-center p-1' name='mainCode'  id='mainCode_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acMcode + "</td> " +#}
{#                        "<td class='text-end p-1' id='acAmts_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'><input style='height: 2rem; font-size: 0.8rem' id='txtAmts_" + (sub_tr_cnt) + "' name='txtAmts' type='text' class='form-control border border-light rounded-1 text-center p-1' value='" + addComma(acAmts) + "'/></td> " +#}
{#                        "<td hidden class='text-start p-1' name='acEmp'  id='acEmp_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acEmp + "</td> " +#}
{#                        "<td class='text-start p-1' id='acNme_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acNme + "</td> " +#}
{#                        "<td hidden class='text-start p-1' name='acSeqn'   id='acSeqn_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acSeqn + "</td> " +#}
{#                        "<td hidden class='text-start p-1' name='acIogb'  id='acIogb_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acIogb + "</td> " +#}
{#                        "<td hidden class='text-start p-1' name='acGubn'  id='acGubn_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acGubn + "</td> " +#}
{#                        "<td class='text-center p-1' name='acBank'  id='acBank_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" +#}
{#                        "<select style='height: 2rem; font-size: 0.8rem' class='form-control border border-light rounded-1 text-center p-1' id='cboBank_" + count + "' name='cboBank'></select></td> " +#}
{#                        "<td hidden class='text-center p-1' name='acBnkCode'  id='acBnkCode_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acBank + "</td> " +#}
{#                        "<td class='text-center p-1' name='acNum'  id='acNum_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" +#}
{#                        "<select style='height: 2rem; font-size: 0.8rem' class='form-control border border-light rounded-1 text-center p-1' id='cboActNum_" + count + "' name='cboActNum'></select></td> " +#}
{#                        "<td hidden class='text-center p-1' name='acNumber'  id='acNumber_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acNum + "</td> " +#}
{#                        "</tr> ");#}
{##}
{#                }#}
{##}
                {#    2. "상계 체크란이 체크됬을때만 "#}
                {#    acIogb 구분 값이 1이면 출금이라서 - 처리/ 2이면 입금이라서 + 처리 #}
{#                    단 계산해서 -값이더라도 -빼고 숫자만 상계금액에 보여주기#}
{##}
                {#document.getElementById('CostOffSet').value = addComma(offTotal)#}
{##}
{#                var costOffSet_val = parseInt($('#real_CostOffSet').val().replaceAll(',', ''));#}
{#                var acAmts_num = parseInt(acAmts.replaceAll(',', ''));#}
{##}
{#                if(acIogb == '1') {#}
{#                    acAmts_num *= -1;#}
{#                }#}
{##}
{#                $('#CostOffSet').val(addComma(Math.abs(costOffSet_val + acAmts_num)));#}
{#                $('#real_CostOffSet').val(costOffSet_val + acAmts_num);#}
{##}
{#            } else {#}
{##}
                {#document.getElementById('CostOffSet').value = addComma(offTotal)#}
{#                // 승인이 체크 되지 않은 경우#}
{#                if(isChkPerChecked == false) {#}
{#                    $('#subTr' + count).remove();#}
{#                }#}
{##}
{#                var costOffSet_val = parseInt($('#real_CostOffSet').val().replaceAll(',', ''));#}
{#                var acAmts_num = parseInt(acAmts.replaceAll(',', ''));#}
{##}
{#                if(acIogb == '2') {#}
{#                    acAmts_num *= -1;#}
{#                }#}
{##}
{#                $('#CostOffSet').val(addComma(Math.abs(costOffSet_val + acAmts_num)));#}
{#                $('#real_CostOffSet').val(costOffSet_val + acAmts_num);#}
{#            }#}
{#        });#}

        $(document).on('change', 'select[name=cboMcode]', function() {
           var _val = $(this).val();

           $(this).parents('tr.subTr_tr').find('td[name=mainCode]').text(_val);
        });

        $(document).on('change', 'select[name=cboActNum]', function() {
           var _val = $(this).val();

           $(this).parents('tr.subTr_tr').find('td[name=acNumber]').text(_val);
        });

        $(document).on('change', 'select[name=cboBank]', function() {
           var _val = $(this).val();

           $(this).parents('tr.subTr_tr').find('td[name=acBnkCode]').text(_val);
        });


        {# 승인 체크박스 선택시 #} //////////////////////////
        $(document).on('change', '#selectTb tbody tr td input.chkPer', function () {

            var count = 0;
            var tr = $(this).parent().parent();
            var iDate = tr.children().eq(1).text()
            var ioDate = iDate.replace(/\-/g, '')
            //var aDate = tr.children().eq(1).text()
            //var acDate = aDate.replace(/\-/g, '')
            var acCust = tr.children().eq(4).text()
            var acTitle = tr.children().eq(3).text()
            var acMcode = tr.children().eq(13).text()
            var acBank = tr.children().eq(15).text()
            var acNum = tr.children().eq(16).text()
            var acEmp = tr.children().eq(8).text()
            var acNme = tr.children().eq(9).text()
            var acSeqn = tr.children().eq(11).text()
            var acIogb = tr.children().eq(12).text()
            var acGubn = tr.children().eq(14).text()


            var acAmts = tr.children().eq(5).text().replace(/\,/g, '')
            var finAmts = tr.children().eq(6).text().replace(/\,/g, '')
            var balance = tr.children().eq(7).text().replace(/\,/g, '')

            var aa = parseInt(acAmts) - parseInt(finAmts)
            if(parseInt(aa) > 0){ balance = aa }

            var count = $(this).closest('tr').prevAll().length;
            var offTotal = 0;

            {#var offSet = $('input[name=inputOffSet]:checked').val();#}
            //var isChkSetOffChecked = tr.find('input.chkPer').is(':checked');

            var pDate = document.getElementById('permitDate').value
            var perDate = pDate.replace(/\-/g, '')

            //은행, 계좌번호는 각각 입력하지 않고 한번에 처리
            var actBank = document.getElementById('actBank').value
            var actNum = document.getElementById('actNumber').value

            var cboActNum = "";
            var cboBank = "";
            var cboMcode = "";
            var cboActNumTxt = "<option value=''>:: 선택 ::</option>";
            var cboBankTxt = "<option value=''>:: 선택 ::</option>";
            var cboMcodeTxt = "<option value=''>:: 선택 ::</option>";

            $("#cboActNum_"+count).html("");
            $("#cboBank_"+count).html("");
            $("#cboMcode_"+count).html("");

            //시행/미시행 구분
            var permitGbn = document.getElementById('inputPermit').value;
            // 시행/상계 구분
            var transGbn = document.getElementById('cboTransGbn').value;

            let data = {"acIogb": acIogb}

            $.ajax({
                type: "post",
                data: data,
                url: '{% url "permit_cbo_search" %}',
                headers: {
                    'X-CSRFTOKEN': '{{ csrf_token }}'
                },
                dataType: 'json',
                success: function (data) {
                    var combolist = data.cboActNum;
                    for (var i = 0; i < combolist.length; i++) {
                        if (combolist[i][0] == acNum) {
                            cboActNumTxt = cboActNumTxt + "<option value='" + combolist[i][0] + "' selected>" + combolist[i][0] + "</option>";
                        } else {
                            cboActNumTxt = cboActNumTxt + "<option value='" + combolist[i][0] + "'>" + combolist[i][0] + "</option>";
                        }
                    }

                    var combolist2 = data.cboBank;
                    for (var i = 0; i < combolist2.length; i++) {
                        if (combolist2[i][0] == acBank) {
                            cboBankTxt = cboBankTxt + "<option value='" + combolist2[i][0] + "' selected>" + combolist2[i][1] + "</option>";
                        } else {
                            cboBankTxt = cboBankTxt + "<option value='" + combolist2[i][0] + "'>" + combolist2[i][1] + "</option>";
                        }
                    }

                    var combolist3 = data.cboMcode;
                    for (var i = 0; i < combolist3.length; i++) {
                        if (combolist3[i][0] == acMcode) {
                            cboMcodeTxt = cboMcodeTxt + "<option value='" + combolist3[i][0] + "' selected>" + combolist3[i][1] + "</option>";
                        } else {
                            cboMcodeTxt = cboMcodeTxt + "<option value='" + combolist3[i][0] + "'>" + combolist3[i][1] + "</option>";
                        }
                    }

                    $("#cboActNum_"+count).append(cboActNumTxt);
                    $("#cboBank_"+count).append(cboBankTxt);
                    $("#cboMcode_"+count).append(cboMcodeTxt);
                }
            })


            var total = 0;
            var countRow = 0;
            if ($(this).is(':checked')) {

                //if (balance <= 0){ alert('승인할 잔액이 없습니다.'); return false;   }
                {#if ($('#subTr' + count).length == 0 && balance > 0) {#}
                if ($('#subTr' + count).length == 0) {

                    var sub_tr_cnt = $('#chkTb tbody tr').length;


                    if(transGbn == '1'){

                        //미시행
                        if(permitGbn == ""){

                            $("#subTb").append(
                            "<tr id='subTr" + count + "' class='subTr_tr'>" +
                            "<td class='text-center p-1' name='perDate'  id='perDate_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + perDate.replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3') + "</td>" +
                            "<td class='text-start p-1' id='acTitle_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acTitle + "</td> " +
                            "<td class='text-start p-1' name='mCode'  id='mCode_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" +
                            "<select style='height: 2rem; font-size: 0.8rem' class='form-control border border-light rounded-1 text-center p-1' id='cboMcode_" + count + "' name='cboMcode'></select></td> " +
                            "<td hidden class='text-center p-1 text-danger' name='mainCode'  id='mainCode_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acMcode + "</td> " +
                            "<td hidden class='text-center p-1 text-danger' name='finAmts'  id='finAmts_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + balance + "</td> " +
                            "<td class='text-end p-1' id='acAmts_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'><input style='height: 2rem; font-size: 0.8rem' id='txtAmts_" + (sub_tr_cnt) + "' name='txtAmts' type='text' class='form-control border border-light rounded-1 text-center p-1' value='" + addComma(balance) + "'/></td> " +
                            "<td hidden class='text-start p-1' name='acEmp'  id='acEmp_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acEmp + "</td> " +
                            "<td class='text-start p-1' id='acNme_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acNme + "</td> " +
                            "<td hidden class='text-center p-1 text-danger' name='acBnkCode'  id='acBnkCode_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + actBank + "</td> " +
                            "<td hidden class='text-center p-1 text-danger' name='acNumber'  id='acNumber_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + actNum + "</td> " +
                            "<td hidden class='text-center p-1 text-danger' name='acTrans'  id='acTrans_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + transGbn + "</td> " +
                            "<td hidden class='text-center p-1' name='ioDate'  id='ioDate_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + ioDate + "</td>" +
                            "<td hidden class='text-start p-1' name='acSeqn'   id='acSeqn_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acSeqn + "</td> " +
                            "<td hidden class='text-start p-1' name='acIogb'  id='acIogb_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acIogb + "</td> " +
                            "<td hidden class='text-start p-1' name='acGubn'  id='acGubn_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acGubn + "</td> " +
                            "<td hidden class='text-start p-1' name='acCust'  id='acCust_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acCust + "</td> " +
                            "</tr> ");
                        }
                        //시행
                        if(permitGbn == "1") {
                            $("#subTb").append(
                                "<tr id='subTr" + count + "' class='subTr_tr'>" +
                                "<td class='text-center p-1' name='perDate'  id='perDate_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + ioDate.replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3') + "</td>" +
                                "<td class='text-start p-1' id='acTitle_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acTitle + "</td> " +
                                "<td class='text-start p-1' name='mCode'  id='mCode_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" +
                                "<select style='height: 2rem; font-size: 0.8rem' class='form-control border border-light rounded-1 text-center p-1' id='cboMcode_" + count + "' name='cboMcode'></select></td> " +
                                "<td hidden class='text-center p-1 text-danger' name='mainCode'  id='mainCode_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acMcode + "</td> " +
                                "<td hidden class='text-center p-1 text-danger' name='finAmts'  id='finAmts_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + balance + "</td> " +
                                "<td class='text-end p-1' id='acAmts_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'><input style='height: 2rem; font-size: 0.8rem' id='txtAmts_" + (sub_tr_cnt) + "' name='txtAmts' type='text' class='form-control border border-light rounded-1 text-center p-1' value='" + addComma(balance) + "'/></td> " +
                                "<td hidden class='text-start p-1' name='acEmp'  id='acEmp_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acEmp + "</td> " +
                                "<td class='text-start p-1' id='acNme_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acNme + "</td> " +
                                "<td hidden class='text-center p-1 text-danger' name='acBnkCode'  id='acBnkCode_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + actBank + "</td> " +
                                "<td hidden class='text-center p-1 text-danger' name='acNumber'  id='acNumber_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + actNum + "</td> " +
                                "<td hidden class='text-center p-1 text-danger' name='acTrans'  id='acTrans_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + transGbn + "</td> " +
                                "<td hidden class='text-center p-1' name='ioDate'  id='ioDate_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + ioDate + "</td>" +
                                "<td hidden class='text-start p-1' name='acSeqn'   id='acSeqn_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acSeqn + "</td> " +
                                "<td hidden class='text-start p-1' name='acIogb'  id='acIogb_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acIogb + "</td> " +
                                "<td hidden class='text-start p-1' name='acGubn'  id='acGubn_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acGubn + "</td> " +
                                "<td hidden class='text-start p-1' name='acCust'  id='acCust_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acCust + "</td> " +
                                "</tr> ");
                        }
                    }

                    //상계////////////////////////////////////////
                    if(transGbn == '2'){

                        var costOffSet_val = parseInt($('#real_CostOffSet').val().replaceAll(',', ''));
                        var acAmts_num = parseInt(acAmts.replaceAll(',', ''));

                        if (acIogb == '1') {
                            acAmts_num *= -1;
                        }

                        $('#CostOffSet').val(addComma(Math.abs(costOffSet_val + acAmts_num)));
                        $('#real_CostOffSet').val(costOffSet_val + acAmts_num);
                    }

                    //시행 체크하면 오른쪽 시행 리스트 총금액 쌓임
                    var costOffSet_val = parseInt($('#real_CostOffSet2').val().replaceAll(',', ''));
                    var acAmts_num = parseInt(acAmts.replaceAll(',', ''));

                    if (acIogb == '1') {
                        acAmts_num *= -1;
                    }

                    $('#inputPrice2').val(addComma(Math.abs(costOffSet_val + acAmts_num)));
                    $('#real_CostOffSet2').val(costOffSet_val + acAmts_num);

                    countRow += 1;
                    $('#inputCnt2').val(countRow);

                }

            } else {

                {#document.getElementById('CostOffSet').value = addComma(offTotal)#}
                if(transGbn == '1') {
                    $('#subTr' + count).remove();
                }

                if(transGbn == '2'){
                    var costOffSet_val = parseInt($('#real_CostOffSet').val().replaceAll(',', ''));
                    var acAmts_num = parseInt(acAmts.replaceAll(',', ''));

                    {#if (acIogb == '2') {#}
                    {#    acAmts_num *= -1;#}
                    {#}#}

                    if (acIogb == '1') {
                        acAmts_num *= -1;
                    }

                    $('#CostOffSet').val(addComma(Math.abs(costOffSet_val - acAmts_num)));
                    $('#real_CostOffSet').val(costOffSet_val - acAmts_num);
                }

                var costOffSet_val = parseInt($('#real_CostOffSet2').val().replaceAll(',', ''));
                var acAmts_num = parseInt(acAmts.replaceAll(',', ''));

                if (acIogb == '1') {
                    acAmts_num *= -1;
                }

                $('#inputPrice2').val(addComma(Math.abs(costOffSet_val - acAmts_num)));
                $('#real_CostOffSet2').val(costOffSet_val - acAmts_num);
                //selectTb
                var ChkTableCount = $('#selectTb tbody tr').length;
                //var checkboxes = $('input:checkbox:checked').length;
                $('#inputCnt2').val(ChkTableCount);
            }
        });

        $(document).on('change', 'input[name=permitDate]', function() {
           var _val = $(this).val();

           $('tr.subTr_tr').find('td[name=perDate]').text(_val);
        });



        {#$(document).on('change', '#inputOffSet', function() {#}
        {#   if($(this).is(':checked')) {#}
        {#       var total_val = 0;#}
        {#       $('#subTb tr.subTr_tr').each(function(index, item) {#}
        {#           if(index > 0) {#}
        {#                var rowid = $(this).attr('id').split('subTr')[1];#}
        {##}
        {#               if($(`#chkSetOff_${rowid}`).is(':checked')) {#}
        {#                   var acAmts_num = parseInt($(this).children().eq(3).text().replaceAll(',', ''));#}
        {#                   var acIogb = $(this).find('[name=acIogb]').text();#}
        {##}
        {#                   if(acIogb == '1') {#}
        {#                       acAmts_num *= -1;#}
        {#                   }#}
        {##}
        {#                   total_val += acAmts_num;#}
        {#               }#}
        {#           }#}
        {#       });#}
        {##}
        {#       $('#CostOffSet').val(addComma(Math.abs(total_val)));#}
        {#       $('#real_CostOffSet').val(total_val);#}
        {#   } else {#}
        {#       $('#CostOffSet').val(0);#}
        {#       $('#real_CostOffSet').val(0);#}
        {#   }#}
        {#});#}

        {#$("#cboActNum_").on("change", function(){#}
        {#    //selected value#}
        {#    $(this).val();#}
        {#    alert($(this).find("option:selected").text();)#}
            {#$("option:selected", this).attr("value");#}
            {#//selected option element#}
            {#$("option:selected", this);#}
            {#$("option:selected", this).text();#}
            {#$(this).find("option:selected").text();#}
        {#});#}

        {# 승인 버튼 #}
        $(document).on('click', "#btnPermit", function () {

            {# 가로로 펼쳐진 td 갯수만큼 받아서 돌리기 #}
            const subCount = $('#subTb tr').length;
            var offSet = document.getElementById('cboTransGbn').value;
            var actNum = document.getElementById('actNumber').value;
            var actBank = document.getElementById('actBank').value;
            var permitDate = document.getElementById('permitDate').value;

            if (actNum == '' || actNum == null) {
                alert('계좌번호를 선택 해주세요.')
                return false
            }

            var pmtArr = [];
            for (var i = 1; i < subCount; i++) {

                var perDate = $('#perDate_' + i).text();
                var ioDate = $('#ioDate_' + i).text();
                var acEmp = $('#acEmp_' + i).text();
                var acSeqn = $('#acSeqn_' + i).text();
                var acIogb = $('#acIogb_' + i).text();
                var finAmts = $('#finAmts_' + i).text();
                var acAmts = $('#txtAmts_' + i).val();
                //var acNum = $('#acNumber_' + i).text();
                var acGubn = $('#acGubn_' + i).text();
                var mCode = $('#mainCode_' + i).text();
                var transGbn = $('#acTrans_' + i).text();
                var acCust = $('#acCust_' + i).text();
                //var acBnkCode = $('#acBnkCode_' + i).text();

                {#if (acNum == '' || acNum == null) {#}
                {#    acNum = document.getElementById('actNumber').value;#}
                {#}#}

                let chk = {"actNum": actNum}

                $.ajax({
                    type: "post",
                    data: chk,
                    url: '{% url "balanceChk" %}',
                    headers: {
                        'X-CSRFTOKEN': '{{ csrf_token }}'
                    },
                    dataType: 'json',
                    success: function (data) {
                        var act = "";
                        if (data.balance < acAmts) {
                            alert('선택한 통장의 잔고가 부족합니다.')
                            return false;
                        }
                    }
                });

                let data = {
                    'perDate': perDate,
                    'ioDate': ioDate,
                    'acEmp': acEmp,
                    'acSeqn': acSeqn,
                    'acIogb': acIogb,
                    'finAmts': finAmts,
                    'acAmts': acAmts,
                    'acGubn': acGubn,
                    'mCode': mCode,
                    'transGbn': transGbn,
                    'acCust': acCust,
                };
                pmtArr.push(data);
            }

            var saveresult = confirm("승인하시겠습니까?")

            if(saveresult == true){
                $.ajax({
                    type: "post",
                    data: {
                        'pmtArrList': JSON.stringify(pmtArr),
                        'offSet': offSet,
                        'actNum': actNum,
                        'permitDate': permitDate,
                        'actBank': actBank,
                    },
                    dataType: "json",
                    url: '{% url "permit_reg_save" %}',
                    headers: {
                        'X-CSRFTOKEN': '{{ csrf_token }}'
                    },
                    success: function (data) {
                        if (data.sucYn === 'Y') {
                            alert('승인 되었습니다.')
                            location.href = "{% url 'permit_reg' %}";
                            $("#real_CostOffSet").val("");
                            $("#CostOffSet").val("");
                            $("#actBank").html("");
                            $("#actNumber").html("");
                            $("#inputPrice2").val("");
                            $("#inputCnt2").val("");
                            document.getElementById('permitDate').valueAsDate = new Date;
                            $("#subTb").html("");
                        }
                    }
                });
            }
            if(saveresult == false){
                alert('취소되었습니다.')
                return false;
            }
        });

        {# 취소 버튼 #}
        $(document).on('click', "#btnDlt", function () {

            var subCount = $('#subTb tr').length;
            subCount = parseInt(subCount) - 1;

            if(subCount > 1){
                alert('시행 취소하실 항목을 한 건만 선택해주세요.')
                return false;
            }

            if(subCount < 2){

                var pmtArr = [];
                for (var i = 1; i < parseInt(subCount) + 1; i++) {

                    var acDate = $('#acDate_' + i).text();
                    var ioDate = $('#ioDate_' + i).text();
                    var acSeqn = $('#acSeqn_' + i).text();
                    var acIogb = $('#acIogb_' + i).text();
                    var acGubn = $('#acGubn_' + i).text();
                    var mCode = $('#mainCode_' + i).text();

                    let data = {
                        'acDate': acDate,
                        'ioDate': ioDate,
                        'acSeqn': acSeqn,
                        'acIogb': acIogb,
                        'acGubn': acGubn,
                        'mCode': mCode
                    };

                    pmtArr.push(data);
                }


                var saveresult = confirm("시행을 취소하시겠습니까?")

                if(saveresult == true){
                    $.ajax({
                        type: "post",
                        data: {
                            'pmtArrList': JSON.stringify(pmtArr),
                        },
                        dataType: "json",
                        url: '{% url "permit_reg_dlt" %}',
                        headers: {
                            'X-CSRFTOKEN': '{{ csrf_token }}'
                        },
                        success: function (data) {
                            if (data.sucYn === 'Y') {
                                alert('시행이 취소 되었습니다.')
                                location.href = "{% url 'permit_reg' %}";
                            }
                        }
                    });
                }
                if(saveresult == false){
                    alert('취소되었습니다.')
                    return false;
                }
            }
        });

        //수정 버튼
        $(document).on('click', "#btnUpt", function () {
            {# 가로로 펼쳐진 td 갯수만큼 받아서 돌리기 #}
            const subCount = $('#subTb tr').length;
            var offSet = document.getElementById('cboTransGbn').value;
            //var offSet = $('input[name=inputOffSet]:checked').val();
            var actNum = document.getElementById('actNumber').value;
            var actBank = document.getElementById('actBank').value;
            var perDate = document.getElementById('permitDate').value;

            if (actNum == '' || actNum == null) {
                alert('계좌번호를 선택 해주세요.')
                return false
            }

            var pmtArr = [];
            for (var i = 1; i < subCount; i++) {

                var perDate = $('#perDate_' + i).text();
                var ioDate = $('#ioDate_' + i).text();
                var acEmp = $('#acEmp_' + i).text();
                var acSeqn = $('#acSeqn_' + i).text();
                var acIogb = $('#acIogb_' + i).text();
                var finAmts = $('#finAmts_' + i).text();
                var acAmts = $('#txtAmts_' + i).val();
                //var acNum = $('#acNumber_' + i).text();
                var acGubn = $('#acGubn_' + i).text();
                var mCode = $('#mainCode_' + i).text();
                var transGbn = $('#acTrans_' + i).text();
                var acCust = $('#acCust_' + i).text();
                //var acBnkCode = $('#acBnkCode_' + i).text();

                {#if (acNum == '' || acNum == null) {#}
                {#    acNum = document.getElementById('actNumber').value;#}
                {#}#}

                let chk = {"actNum": actNum}

                $.ajax({
                    type: "post",
                    data: chk,
                    url: '{% url "balanceChk" %}',
                    headers: {
                        'X-CSRFTOKEN': '{{ csrf_token }}'
                    },
                    dataType: 'json',
                    success: function (data) {
                        var act = "";
                        if (data.balance < acAmts) {
                            alert('선택한 통장의 잔고가 부족합니다.')
                            return false;
                        }
                    }
                });

                let data = {
                    'perDate': perDate,
                    'ioDate': ioDate,
                    'acEmp': acEmp,
                    'acSeqn': acSeqn,
                    'acIogb': acIogb,
                    'finAmts': finAmts,
                    'acAmts': acAmts,
                    'acGubn': acGubn,
                    'mCode': mCode,
                    'transGbn': transGbn,
                    'acCust': acCust,
                };
                pmtArr.push(data);
            }

            var saveresult = confirm("수정하시겠습니까?")

            if(saveresult == true){
                $.ajax({
                    type: "post",
                    data: {
                        'pmtArrList': JSON.stringify(pmtArr),
                        'offSet': offSet,
                        'actNum': actNum,
                        'perDate': perDate,
                        'actBank': actBank,
                    },
                    dataType: "json",
                    url: '{% url "permit_reg_update" %}',
                    headers: {
                        'X-CSRFTOKEN': '{{ csrf_token }}'
                    },
                    success: function (data) {
                        if (data.sucYn === 'Y') {
                            alert('수정 되었습니다.')
                            location.href = "{% url 'permit_reg' %}";
                        }
                    }
                });
            }
            if(saveresult == false){
                alert('취소되었습니다.')
                return false;
            }
        });

    </script>
{% endblock %}


{#                        "<tr id='subTr" + count + "' class='subTr_tr'>" +#}
{#                        "<td class='text-center p-1' name='perDate'  id='perDate_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + perDate.replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3') + "</td>" +#}
{#                        "<td class='text-start p-1' id='acTitle_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acTitle + "</td> " +#}
{#                        "<td class='text-start p-1' name='mCode'  id='mCode_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" +#}
{#                        "<select style='height: 2rem; font-size: 0.8rem' class='form-control border border-light rounded-1 text-center p-1' id='cboMcode_" + count + "' name='cboMcode'></select></td> " +#}
{#                        "<td hidden class='text-center p-1 text-danger' name='mainCode'  id='mainCode_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acMcode + "</td> " +#}
{#                        "<td hidden class='text-center p-1 text-danger' name='finAmts'  id='finAmts_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + balance + "</td> " +#}
{#                        "<td class='text-end p-1' id='acAmts_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'><input style='height: 2rem; font-size: 0.8rem' id='txtAmts_" + (sub_tr_cnt) + "' name='txtAmts' type='text' class='form-control border border-light rounded-1 text-center p-1' value='" + addComma(balance) + "'/></td> " +#}
{#                        "<td hidden class='text-start p-1' name='acEmp'  id='acEmp_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acEmp + "</td> " +#}
{#                        "<td class='text-start p-1' id='acNme_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acNme + "</td> " +#}
{#                        "<td class='text-center p-1' name='acBank'  id='acBank_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" +#}
{#                        "<select style='height: 2rem; font-size: 0.8rem' class='form-control border border-light rounded-1 text-center p-1' id='cboBank_" + count + "' name='cboBank'></select></td> " +#}
{#                        "<td hidden class='text-center p-1 text-danger' name='acBnkCode'  id='acBnkCode_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + actBank + "</td> " +#}
{#                        "<td class='text-center p-1' name='acNum'  id='acNum_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" +#}
{#                        "<select style='height: 2rem; font-size: 0.8rem' class='form-control border border-light rounded-1 text-center p-1' id='cboActNum_" + count + "' name='cboActNum'></select></td> " +#}
{#                        "<td hidden class='text-center p-1 text-danger' name='acNumber'  id='acNumber_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + actNum + "</td> " +#}
{#                        "<td hidden class='text-center p-1 text-danger' name='acTrans'  id='acTrans_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + transGbn + "</td> " +#}
{#                        "<td hidden class='text-center p-1' name='ioDate'  id='ioDate_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + ioDate + "</td>" +#}
{#                        "<td hidden class='text-start p-1' name='acSeqn'   id='acSeqn_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acSeqn + "</td> " +#}
{#                        "<td hidden class='text-start p-1' name='acIogb'  id='acIogb_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acIogb + "</td> " +#}
{#                        "<td hidden class='text-start p-1' name='acGubn'  id='acGubn_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + acGubn + "</td> " +#}
{#                        "</tr> ");#}