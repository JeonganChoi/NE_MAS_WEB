{% extends "layouts/base.html" %}

{% block title %} 입/출금 등록 {% endblock %}

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}
{#         style="background-image: url('/static/assets/img/header-blue-purple.jpg'); background-position: bottom;"#}
    <div class="height-100" style="background-image: url('/static/assets/img/header-blue-purple.jpg'); background-position: bottom;"></div>
    <div class="container-fluid py-1 my-2">
        <div class="row mt-n7">
            <div class="col-lg-12">
                <div class="card blur border border-white rounded-2 shadow-xs">
                    <div class="card-body pb-2">
                        <div class="row">
                            <div class="col-lg-6 col-6 text-start">
                                <h5 class="text-dark font-weight-bold"><i class="fas fa-credit-card fas-4 me-3"></i>입/출금 등록</h5>
                            </div>
                            <div class="col-lg-6 col-6 text-end">
                                <button type="button" class="btn btn-sm btn-primary text-white text-sm" id="btnSave" name="btnSave">저 장</button>
                                <button type="button" class="btn btn-sm btn-linkedin text-white text-sm" id="btnClear" name="btnClear">초기화</button>
                                <button type="button" class="btn btn-sm btn-light text-dark text-sm" id="btnDlt" name="btnDlt">삭제</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-8 col-8">
                <div class="card border border-white shadow-xs height-600">
                    <div class="card-header pb-0">
                        <div class="row p-0">
                            <div class="col-lg-6 col-6">
                              <div class="input-group shadow-none">
                                  <label style="font-size: 0.85rem; width: 4rem"><i class="fas fa-search me-2"></i>일자</label>
                                  <input class="form-control border border-light rounded-1 text-center me-2" type="date" name="inputStrDate" id="inputStrDate" style="height: 2rem">
                                  <label class="mt-2 me-4" style="font-size: 1rem">-</label>
                                  <input class="form-control border border-light rounded-1 text-center me-2" type="date" name="inputEndDate" id="inputEndDate" style="height: 2rem">
                              </div>
                            </div>
                            <div class="col-lg-6 col-6 text-end">
                                 <button type="button" class="btn btn-sm btn-success" id="btnExcel" name="btnExcel"><i class="fas fa-file-excel fs-6 me-2"></i>엑셀</button>
                                 <button type="button" class="btn btn-sm bg-gradient-info" id="btnSearch" name="btnSearch"><i class="fas fa-search fs-6 me-2"></i>조회</button>
                            </div>
                        </div>
                        <div class="row p-0">
                            <div class="col-lg-4 col-4">
                                <div class="input-group shadow-none">
                                    <label style="font-size: 0.85rem; width: 4rem"><i class="fas fa-search me-2"></i>거래처</label>
                                    <select class="form-control border border-light rounded-1 text-center p-0" name="inputCust" id="inputCust" style="font-size: 0.8rem; height: 2rem"></select>
                                </div>
                            </div>
                            <div class="col-lg-4 col-4">
                                <div class="input-group shadow-none">
                                    <label style="font-size: 0.85rem; width: 5rem"><i class="fas fa-search me-2"></i>계좌번호</label>
                                    <select class="form-control border border-light rounded-1 text-center p-0" name="inputAct" id="inputAct" style="font-size: 0.8rem; height: 2rem"></select>
                                </div>
                            </div>
                            <div class="col-lg-4 col-4">
                                <div class="input-group shadow-none">
                                    <label style="font-size: 0.85rem; width: 4rem"><i class="fas fa-search me-2"></i>잔액</label>
                                    <input readonly class="form-control border border-light rounded-1 text-end me-2" type="text" name="inputBal" id="inputBal" style="font-size: 0.8rem; height: 2rem">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive-sm height-400 overflow-auto border border-light">
                          <table class="table mb-0 align-items-center justify-content-center" id="grid">
                              <colgroup>
                                  <col width="3%">
                                  <col width="8%">
                                  <col width="10%">
                                  <col width="10%">
                                  <col width="4%">
                                  <col width="10%">
                                  <col width="10%">
                                  <col width="10%">
                                  <col width="10%">
                                  <col width="8%">
                                  <col width="4%">
                                  <col width="4%">
                              </colgroup>
                            <thead class="text-white font-weight-bolder text-center" style="background-color: rgb(0, 92, 151);">
                              <tr>
                                <th style="font-size: 0.85rem" class="p-1">선택</th>
                                <th style="font-size: 0.85rem" class="p-1">거래일시</th>
                                <th style="font-size: 0.85rem" class="p-1">계정 명</th>
                                <th style="font-size: 0.85rem" class="p-1">회계 계정명</th>
                                <th style="font-size: 0.85rem" class="p-1">구 분</th>
                                <th style="font-size: 0.85rem" class="p-1">거래처</th>
                                <th style="font-size: 0.85rem" class="p-1">입 금</th>
                                <th style="font-size: 0.85rem" class="p-1">출 금</th>
                                <th style="font-size: 0.85rem" class="p-1">잔 금</th>
                                <th style="font-size: 0.85rem" class="p-1">통장명</th>
                                <th style="font-size: 0.85rem" class="p-1">결재</th>
                                <th style="font-size: 0.85rem" class="p-1">승인</th>
                              </tr>
                            </thead>
                            <tbody id="withMainTb">
                              <tr id="withMainTr" class="withMainTr_tr">

                              </tr>
                            </tbody>
                          </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-4 mb-md-0">
                <div class="card border-0 shadow-xs height-600">
                    <form class="form-control border-0 shadow-none dropzone p-0" id="dropzone" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="card-body">
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-6">
                                        <label class="text-sm text-danger"><i class="far fa-edit me-2"></i>입/출금 구분</label>
                                        <select class="form-control border border-light rounded-1 text-center bg-danger-soft p-1" name="cboWitGbn" id="cboWitGbn" style="height: 2rem; font-size: 0.8rem"></select>
                                    </div>
                                    <div class="col-6">
                                        <label class="text-sm"><i class="far fa-calendar me-2"></i>등록 일자</label>
                                        <input class="form-control text-center" type="date" id="txtWitRegDate" name="txtWitRegDate" style="height: 2rem; font-size: 0.8rem"/>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <label class="mt-2 text-sm"><i class="fa fa-check-square-o me-2 text-dark text-sm"></i>관리계정</label>
                                        <select class="form-control border border-light rounded-1 text-center p-1" name="cboAdminCode" id="cboAdminCode" style="height: 2rem; font-size: 0.8rem"></select>
                                    </div>
                                    <div class="col-6">
                                        <label class="mt-2 text-sm"><i class="far fa-edit me-2"></i>제 목</label>
                                        <input class="form-control text-start" type="text" id="txtTitle" name="txtTitle" style="height: 2rem; font-size: 0.8rem"/>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group basic">
                                <div class="row mt-2">
                                    <div class="col-6">
                                        <label class="text-sm"><i class="fa fa-check-square-o me-2 text-dark text-sm"></i>거래처</label>
                                        <select class="form-control text-center p-1" name="cboWitCust" id="cboWitCust" style="height: 2rem; font-size: 0.8rem"></select>
                                    </div>
                                    <div class="col-6">
                                        <label class="text-sm"><i class="fa fa-check-square-o me-2 text-dark text-sm"></i>금액</label>
                                        <input class="form-control text-end" type="text" id="txtWitPrice" name="txtWitPrice" style="height: 2rem; font-size: 0.8rem"/>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-6">
                                        <label class="text-sm"><i class="fa fa-check-square-o me-2 text-dark text-sm"></i>사용처</label>
                                        <input class="form-control text-start" type="text" id="txtWhere" name="txtWhere" style="height: 2rem; font-size: 0.8rem"/>
                                    </div>
                                    <div class="col-6">
                                        <label class="text-sm" id="dateLabel"><i class="far fa-calendar me-2"></i>예정 일자</label>
                                        <input class="form-control text-center" type="date" id="txtExDate" name="txtExDate" style="height: 2rem; font-size: 0.8rem"/>
                                    </div>
                                </div>
                                <div class="row">
                                    <div hidden class="col-4">
                                        <input class="form-control text-end" type="number" id="txtWitSeq" name="txtWitSeq"/>
                                        <input class="form-control text-end" type="number" id="txtWitRecn" name="txtWitRecn"/>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-3 method">
                                        <label class="mt-2 text-sm"><i class="fa fa-check-square-o me-2 text-dark text-sm"></i>결제방법</label>
                                        <select class="form-control border border-light rounded-1 text-center p-1" name="cboWitMethod" id="cboWitMethod" style="height: 2rem; font-size: 0.8rem"></select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-4 cboBank">
                                        <label class="mt-2 text-sm"><i class="fa fa-check-square-o me-2 text-dark text-sm"></i>은행</label>
                                        <select class="form-control border border-light rounded-1 text-center p-1" name="cboBank" id="cboBank" style="height: 2rem; font-size: 0.8rem"></select>
                                    </div>
                                    <div class="col-4 cboCard">
                                        <label class="mt-2 text-sm"><i class="fa fa-check-square-o me-2 text-dark text-sm"></i>카드</label>
                                        <select class="form-control border border-light rounded-1 text-center p-1" name="cboWitCard" id="cboWitCard" style="height: 2rem; font-size: 0.8rem"></select>
                                    </div>
                                    <div class="col-4 cboAct">
                                        <label class="mt-2 text-sm"><i class="fa fa-check-square-o me-2 text-dark text-sm"></i>계좌번호</label>
                                        <select class="form-control border border-light rounded-1 text-center p-1" name="cboWitActNum" id="cboWitActNum" style="height: 2rem; font-size: 0.8rem"></select>
                                    </div>
                                </div>
                                <div hidden class="row">
                                    <div class="col-6">
                                        <label class="mt-2 text-sm"><i class="fa fa-check-square-o me-2 text-dark text-sm"></i>어음번호</label>
                                        <input class="form-control text-center" type="text" id="txtWitCashNum" name="txtWitCashNum" style="height: 2rem; font-size: 0.8rem"/>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <label class="mt-2 text-sm"><i class="fas fa-edit me-2"></i>내용</label>
                                        <input class="form-control text-start" type="text" id="txtWitRemark" name="txtWitRemark" style="height: 2rem; font-size: 0.8rem"/>
                                    </div>
                                    <div class="col-6">
                                        <label class="mt-2 text-sm"><i class="fas fa-edit me-2"></i>지급정보</label>
                                        <input class="form-control text-start" type="text" id="txtInfo" name="txtInfo" style="height: 2rem; font-size: 0.8rem"/>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group replace">
                                <div class="row mt-4">
                                    <div class="col-4">
                                        <label class="text-sm"><i class="far fa-calendar me-2"></i>등록 일자</label>
                                        <input class="form-control text-center" type="date" id="txtWitRegDate2" name="txtWitRegDate2" style="height: 2rem; font-size: 0.8rem"/>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-3">
                                        <label class="mt-2 text-sm"><i class="fa fa-check-square-o me-2 text-dark text-sm"></i>출금 은행</label>
                                        <select class="form-control border border-light rounded-1 text-center p-1" name="cboOutBank" id="cboOutBank" style="height: 2rem; font-size: 0.8rem"></select>
                                    </div>
                                    <div class="col-3">
                                        <label class="mt-2 text-sm"><i class="fa fa-check-square-o me-2 text-dark text-sm"></i>출금 계좌 번호</label>
                                        <select class="form-control border border-light rounded-1 text-center p-1" name="cboOutAct" id="cboOutAct" style="height: 2rem; font-size: 0.8rem"></select>
                                    </div>
                                    <div class="col-3">
                                        <label class="mt-2 text-sm"><i class="fa fa-check-square-o me-2 text-dark text-sm"></i>입금 은행</label>
                                        <select class="form-control border border-light rounded-1 text-center p-1" name="cboInBank" id="cboInBank" style="height: 2rem; font-size: 0.8rem"></select>
                                    </div>
                                    <div class="col-3">
                                        <label class="mt-2 text-sm"><i class="fa fa-check-square-o me-2 text-dark text-sm"></i>입금 계좌 번호</label>
                                        <select class="form-control border border-light rounded-1 text-center p-1" name="cboInAct" id="cboInAct" style="height: 2rem; font-size: 0.8rem"></select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-3">
                                        <label class="mt-2 text-sm"><i class="fa fa-check-square-o me-2 text-dark text-sm"></i>금액</label>
                                        <input class="form-control text-end" type="number" id="txtWitPrice2" name="txtWitPrice2" style="height: 2rem; font-size: 0.8rem"/>
                                    </div>
                                    <div hidden class="col-4">
                                        <input class="form-control text-end" type="number" id="txtWitSeq2" name="txtWitSeq2"/>
                                        <input class="form-control text-end" type="number" id="txtWitRecn2" name="txtWitRecn2"/>
                                    </div>
                                    <div class="col-3">
                                        <i class="far fa-calendar me-2"></i><label class="mt-2 text-sm" id="dateLabel">대체 일자</label>
                                        <input class="form-control text-center" type="date" id="txtOffDate" name="txtOffDate" style="height: 2rem; font-size: 0.8rem"/>
                                    </div>
                                    <div class="col-6">
                                        <label class="mt-2 text-sm"><i class="fas fa-edit me-2"></i>내용</label>
                                        <input class="form-control text-start" type="text" id="txtWitRemark2" name="txtWitRemark2" style="height: 2rem; font-size: 0.8rem"/>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="row mt-3">
                                    <div class="col-6 text-start">
                                        <label class="form-label"><i class="fas fa-image me-2"></i>증빙서류 등록</label>
                                        <input name="file" id="file" type="file" class="" style="display: none;" />
                                        <div class="form-group text-start mt-2">
                                            <a class="btn btn-outline-dark btn-sm" type="button" id="btnFile">파일 선택</a>
                                            <a class="btn btn-outline-danger btn-sm" type="button" id="btnFileLook">파일 보기</a>
                                        </div>
                                        <div><span id="file_name"></span></div>
                                    </div>
                                    <div class="col-6 text-start line">
                                        <label class="form-label"><i class="fas fa-pen me-2"></i>결재선 지정</label>
                                        <div class="form-group mt-2 mb-0">
                                            <div class="row">
                                                <div class="col-6 text-start">
                                                    <button type="button" class="btn btn-sm btn-dark" style="width: 10vw" id="btnDst" name="btnDst" data-bs-toggle='modal' data-bs-target='#DecisionModal'>결재선 지정</button>
                                                </div>
                                                <div class="col-6 text-start">
                                                    <input readonly class="form-control border-0 text-danger shadow-none bg-transparent" type="text" id="warning"  name="warning" style="font-size: 1rem"/>
                                                </div>
                                            </div>
                                        </div>
                                        <div hidden class="table-responsive-sm overflow-auto">
                                            <table class="table mb-0 align-items-center justify-content-center" id="signTb">
                                              <tbody class="bg-warning text-center font-weight-bolder text-white" id="signTd">

                                              </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>



<!-- Modal -->
    <div class="modal fade" id="DecisionModal" tabindex="-1" role="dialog" aria-labelledby="DecisionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document" style="min-width: 40vw">
            <div class="modal-content">
                <form method="post">
                    {% csrf_token %}
                    <div class="modal-header bg-dark text-end" style="height: 5vh">
                        <button class="btn btn-close border border-white"><i class="fas fa-xmark"></i></button>
                    </div>
                    <div class="modal-body">
                        <div class="row p-2">
                            <div class="col-6">
                                <div class="row">
                                    <div class="col-4 text-start"><h6 class="text-sm"><i class="fas fa-grip-lines me-2"></i>결재선 지정</h6></div>
                                    <div class="col-8 text-end">
                                        <div class="form-group">
                                            <label class="text-sm me-2">부 서</label>
                                            <select class="border border-light rounded-1 text-center" name="cboDpt" id="cboDpt" style="height: 1.5rem; font-size: 0.8rem; width: 8rem"></select>
                                        </div>
                                    </div>
                                </div>
                                <div class="table-responsive-sm overflow-auto border border-light height-300">
                                  <table class="table mb-0 align-items-center justify-content-center" id="modalMainTb">
                                      <colgroup>
                                          <col width="3%">
                                          <col width="10%">
                                          <col width="10%">
                                          <col width="10%">
                                      </colgroup>
                                    <thead class="text-white font-weight-bolder text-center bg-primary">
                                      <tr>
                                        <th style="font-size: 0.8rem" class="p-1">선 택</th>
                                        <th style="font-size: 0.8rem" class="p-1">부 서</th>
                                        <th style="font-size: 0.8rem" class="p-1">직 책</th>
                                        <th style="font-size: 0.8rem" class="p-1">이 름</th>
                                      </tr>
                                    </thead>
                                    <tbody id="modalMainTd">
                                      <tr id="#modalMainTr" class="modalMainTr_tr">

                                      </tr>
                                    </tbody>
                                  </table>
                                </div>
                            </div>
                            <div class="col-1"></div>
                            <div class="col-5">
                                <h6 class="text-sm"><i class="fas fa-file-signature me-2"></i>결재 라인</h6>
                                <div class="table-responsive-sm overflow-auto border border-light height-300 mt-4">
                                  <table class="table mb-0 align-items-center justify-content-center" id="modalSubTb">
                                      <colgroup>
                                          <col hidden width="10%">
                                          <col hidden width="10%">
                                          <col hidden width="10%">
                                          <col width="10%">
                                          <col width="10%">
                                      </colgroup>
                                    <thead class="text-white font-weight-bolder text-center bg-gray-700">
                                      <tr>
                                        <th hidden style="font-size: 0.8rem" class="p-1">부 서</th>
                                        <th hidden style="font-size: 0.8rem" class="p-1">직 책</th>
                                        <th hidden style="font-size: 0.8rem" class="p-1">사 번</th>
                                        <th style="font-size: 0.8rem" class="p-1">Seg</th>
                                        <th style="font-size: 0.8rem" class="p-1">이 름</th>
                                      </tr>
                                    </thead>
                                    <tbody id="modalSubTd">
                                    </tbody>
                                  </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer text-end border-0">
                        <button type="button" class="btn btn-sm btn-warning text-white font-weight-bolder" id="btnSave2" name="btnSave2" style="width: 10vw">확 인</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

{% endblock %}

{% block javascripts %}

    <script>
        Dropzone.autoDiscover = false;
        var drop = document.getElementById('dropzone')
        var myDropzone = new Dropzone(drop, {
            url: "/file/post",
            addRemoveLinks: true

        });
    </script>

    <script>

        //파일선택창에서 이미지 선택 후 확인 누르면 그 동시에 발생하는 이벤트
        $('#file').change(function(event) {
            var file = event.target.files[0]

            var reader = new FileReader(); //1

            reader.onload = function(e) {
                $('#itemimage').attr('src', e.target.result); //3
            }

            reader.readAsDataURL(file); //2
        });

        $(document).on('click', '#btnDst', function () {

            var chk_cust_id_arr = [];
            var cboDpt = "";
            var cboDptTxt = "<option value=''>:: 선택 ::</option>";

            $("#cboDpt").html("");

            $.ajax({
                type: "post",
                data: {
                    'empList': JSON.stringify(chk_cust_id_arr),
                    "cboDpt": cboDpt,
                },
                url: '{% url "apvLine_modal" %}',
                headers: {
                    'X-CSRFTOKEN': '{{ csrf_token }}'
                },
                dataType: 'json',
                success: function (data) {
                    var list = data.mainList;

                    $("#modalMainTd").html("");

                    for (var i = 0; i < list.length; i++) {

                        $("#modalMainTd").append(
                            "<tr id='#modalMainTr' class='modalMainTr_tr'>" +
                            "<td class='text-center p-1' style='font-size: 0.8rem'><input class='' type='checkbox' id='chkEmp_" + list[i][4] + "' name='chkEmp[]' value='" + list[i][0] + "," + list[i][2] + "," + list[i][4] + "'/></td>" +
                            "<td hidden class='text-start p-1' style='font-size: 0.8rem'>" + list[i][0] + "</td>" +
                            "<td class='text-start p-1' style='font-size: 0.8rem'>" + list[i][1] + "</td>" +
                            "<td hidden class='text-start p-1' style='font-size: 0.8rem'>" + list[i][2] + "</td> " +
                            "<td class='text-start p-1' style='font-size: 0.8rem'>" + list[i][3] + "</td> " +
                            "<td hidden class='text-start p-1' style='font-size: 0.8rem'>" + list[i][4] + "</td> " +
                            "<td class='text-start p-1' style='font-size: 0.8rem'>" + list[i][5] + "</td> " +
                            "</tr> ");
                    }

                    $('.subEmpNme').each(function() {
                        const code = $(this).data('code');
                        $(`#chkEmp_${code}`).trigger('click');
                    });

                    var combolist = data.cboDpt;
                    for (var i = 0; i < combolist.length; i++) {
                        if (combolist[i][0] == cboDpt) {
                            cboDptTxt = cboDptTxt + "<option value='" + combolist[i][0] + "' selected>" + combolist[i][1] + "</option>";
                        } else {
                            cboDptTxt = cboDptTxt + "<option value='" + combolist[i][0] + "'>" + combolist[i][1] + "</option>";
                        }
                    }

                    $("#cboDpt").append(cboDptTxt);
                }
            })

            $('#DecisionModal').show();
        });

        {# 부서 선택시 계좌명 바인딩 #}
        $('#cboDpt').change(function () {

            var chk_cust_id_arr = [];
            var cboDpt = document.getElementById('cboDpt').value;

            $.ajax({
                type: "post",
                data: {
                    'empList': JSON.stringify(chk_cust_id_arr),
                    "cboDpt": cboDpt,
                },
                url: '{% url "apvLine_modal" %}',
                headers: {
                    'X-CSRFTOKEN': '{{ csrf_token }}'
                },
                dataType: 'json',
                success: function (data) {
                    var list = data.mainList;

                    $("#modalMainTd").html("");

                    for (var i = 0; i < list.length; i++) {

                        $("#modalMainTd").append(
                            "<tr id='#modalMainTr' class='modalMainTr_tr'>" +
                            "<td class='text-center p-1' style='font-size: 0.8rem'><input class='' type='checkbox' id='chkEmp[]' name='chkEmp[]' value='" + list[i][0] + "," + list[i][2] + "," + list[i][4] + "'/></td>" +
                            "<td hidden class='text-start p-1' style='font-size: 0.8rem'>" + list[i][0] + "</td>" +
                            "<td class='text-start p-1' style='font-size: 0.8rem'>" + list[i][1] + "</td>" +
                            "<td hidden class='text-start p-1' style='font-size: 0.8rem'>" + list[i][2] + "</td> " +
                            "<td class='text-start p-1' style='font-size: 0.8rem'>" + list[i][3] + "</td> " +
                            "<td hidden class='text-start p-1' style='font-size: 0.8rem'>" + list[i][4] + "</td> " +
                            "<td class='text-start p-1' style='font-size: 0.8rem'>" + list[i][5] + "</td> " +
                            "</tr> ");
                    }
                }
            })

        });

        $(document).on('change', '#modalMainTb tbody tr td:first-child input[type=checkbox]', function() {
            var tr = $(this).parent().parent();
            var empDpt = tr.children().eq(1).text()
            var empGbn = tr.children().eq(3).text()
            var empNbr = tr.children().eq(5).text()
            var empNme = tr.children().eq(6).text()

            if($(this).is(':checked')) {
                if($('#modalSubTr' + empNbr).length == 0) {

                    var sub_tr_cnt = $('#modalSubTb tbody tr').length;

                    $("#modalSubTd").append(
                        "<tr id='modalSubTr" + empNbr + "' class='modalSubTr_tr'>" +
                        "<td hidden class='text-start p-1' id='empDpt_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + empDpt + "</td>" +
                        "<td hidden class='text-start p-1' id='empGbn_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + empGbn + "</td> " +
                        "<td hidden class='text-start p-1' name='empNbr' id='empNbr_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + empNbr + "</td> " +
                        "<td class='text-start p-1'  id='empNbr_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + empNbr + "</td> " +
                        "<td class='text-start p-1' id='empNme_" + (sub_tr_cnt) + "' style='font-size: 0.8rem'>" + empNme + "</td> " +
                        "</tr> ");

                }
            } else {
                $('#modalSubTr' + empNbr).remove();
            }
        });

        {# 확인 버튼 클릭시 #}
        $(document).on('click', '#btnSave2', function () {

            {#var saveresult = confirm("결재라인을 지정하시겠습니까?")#}



            const tbRow = $('#modalSubTd tr').length;

            var empArr = [];
            for (var i = 0; i < tbRow; i++) {

                var empDpt = $('#empDpt_' + i).text();
                var empGbn = $('#empGbn_' + i).text();
                var empNbr = $('#empNbr_' + i).text();
                var empNme = $('#empNme_' + i).text();

                let data = {
                    'empDpt': empDpt,
                    'empGbn': empGbn,
                    'empNbr': empNbr,
                    'empNme': empNme
                };

                empArr.push(data);

            }

            $("#signTd").html("");
            $("#signTd").append("<tr id='signTdTr' class='signTdTr_tr'>" + + " </tr>" );
            for (var i = 0; i < empArr.length; i++) {

                $("#signTd").append(
                    "<td hidden id='signTdTr" + empArr[i][2] + "' class='signTdTr_tr'></td>" +
                    "<td hidden class='text-center p-1' id='subSeq_" + i + "' style='font-size: 0.8rem'>" + i + "</td>" +
                    "<td hidden class='text-center p-1' id='subEmpDpt_" + i + "' style='font-size: 0.8rem'>" + empArr[i].empDpt + "</td>" +
                    "<td hidden class='text-center p-1' id='subEmpGbn_" + i + "' style='font-size: 0.8rem'>" + empArr[i].empGbn + "</td>" +
                    "<td hidden class='text-center p-1' id='subEmpNbr_" + i + "' style='font-size: 0.8rem'>" + empArr[i].empNbr + "</td>" +
                    "<td class='text-start p-1 border border-white' id='subEmpNme_" + i + "' style='font-size: 0.8rem'>" + empArr[i].empNme + "</td>");
            }

            $('#DecisionModal').modal('hide');

        });

    </script>

    <script>
        $(document).ready(function () {

            var cboCust = "";
            var cboAct = "";
            var cboWitCust2 = "";
            var cboWitGbn = "";
            var cboAdminCode = "";
            var cboWitMethod = "";
            var cboWitActNum = "";
            var cboWitCard = "";
            var cboBank = "";
            var cboCustTxt = "<option value=''>:: 선택 ::</option>";
            var cboActTxt = "<option value=''>:: 선택 ::</option>";
            var cboWitCustTxt = "<option value=''>:: 선택 ::</option>";
            var cboWitGbnTxt = "";
            var cboAdminCodeTxt = "<option value=''>:: 선택 ::</option>";
            var cboWitMethodTxt = "<option value=''>:: 선택 ::</option>";
            var cboWitActNumTxt = "<option value=''>:: 선택 ::</option>";
            var cboWitCardTxt = "<option value=''>:: 선택 ::</option>";
            var cboBankTxt = "<option value=''>:: 선택 ::</option>";

            $("#inputCust").html("");
            $("#inputAct").html("");
            $("#cboWitCust").html("");
            $("#cboWitGbn").html("");
            $("#cboAdminCode").html("");
            $("#cboWitMethod").html("");
            $("#cboWitActNum").html("");
            $("#cboWitCard").html("");
            $("#cboBank").html("");
            $("#txtWitRegDate").val("");
            $("#txtWitSeq").val("");
            $("#txtWitRecn").val("");
            $("#txtWitPrice").val("");
            $("#txtWitCashNum").val("");
            $("#txtWitRemark").val("");

            $('.basic').show();
            $('.replace').hide();
            {#$('.method').show();#}
            {#$('.cboCard').hide();#}
            {#$('.cboBank').hide();#}
            {#$('.cboAct').hide();#}

            var date = new Date();
            date.setMonth(date.getMonth() - 3);

            document.getElementById("inputStrDate").valueAsDate = date;
            document.getElementById("inputEndDate").valueAsDate = new Date;
            document.getElementById("txtWitRegDate").valueAsDate = new Date;

            var acIogb = "";
            var acDate = "";
            var acNum = "";
            var acCust = "";
            var acMcode = "";
            var cboGbn = "1";

            let data2 = {
                "acIogb": acIogb,
                "acDate": acDate,
                "acNum": acNum,
                "acCust": acCust,
                "acMcode": acMcode,
                "cboGbn": cboGbn
            }

            $.ajax({
                type: "post",
                data: data2,
                url: '{% url "payment_search" %}',
                headers: {
                    'X-CSRFTOKEN': '{{ csrf_token }}'
                },
                dataType: 'json',
                success: function (data) {

                    var combolist = data.cboCust;
                    for (var i = 0; i < combolist.length; i++) {
                        if (combolist[i][0] == cboWitCust2) {
                            cboWitCustTxt = cboWitCustTxt + "<option value='" + combolist[i][0] + "' selected>" + combolist[i][1] + "</option>";
                        } else {
                            cboWitCustTxt = cboWitCustTxt + "<option value='" + combolist[i][0] + "'>" + combolist[i][1] + "</option>";
                        }
                    }

                    var combolist2 = data.cboGgn;
                    for (var i = 0; i < combolist2.length; i++) {
                        if (combolist2[i][0] == cboWitGbn) {
                            cboWitGbnTxt = cboWitGbnTxt + "<option value='" + combolist2[i][0] + "' selected>" + combolist2[i][1] + "</option>";
                        } else {
                            cboWitGbnTxt = cboWitGbnTxt + "<option value='" + combolist2[i][0] + "'>" + combolist2[i][1] + "</option>";
                        }
                    }

                    var combolist3 = data.cboPay;
                    for (var i = 0; i < combolist3.length; i++) {
                        if (combolist3[i][0] == cboWitMethod) {
                            cboWitMethodTxt = cboWitMethodTxt + "<option value='" + combolist3[i][0] + "' selected>" + combolist3[i][1] + "</option>";
                        } else {
                            cboWitMethodTxt = cboWitMethodTxt + "<option value='" + combolist3[i][0] + "'>" + combolist3[i][1] + "</option>";
                        }
                    }

                    var combolist4 = data.cboMCode;
                    for (var i = 0; i < combolist4.length; i++) {
                        if (combolist4[i][0] == cboAdminCode) {
                            cboAdminCodeTxt = cboAdminCodeTxt + "<option value='" + combolist4[i][0] + "' selected>" + combolist4[i][1] + "</option>";
                        } else {
                            cboAdminCodeTxt = cboAdminCodeTxt + "<option value='" + combolist4[i][0] + "'>" + combolist4[i][1] + "</option>";
                        }
                    }

                    var combolist5 = data.cboAcnumber;
                    for (var i = 0; i < combolist5.length; i++) {
                        if (combolist5[i][0] == cboWitActNum) {
                            cboWitActNumTxt = cboWitActNumTxt + "<option value='" + combolist5[i][0] + "' selected>" + combolist5[i][0] + "</option>";
                        } else {
                            cboWitActNumTxt = cboWitActNumTxt + "<option value='" + combolist5[i][0] + "'>" + combolist5[i][0] + "</option>";
                        }
                    }

                    var combolist6 = data.cboCard;
                    for (var i = 0; i < combolist6.length; i++) {
                        if (combolist6[i][0] == cboWitCard) {
                            cboWitCardTxt = cboWitCardTxt + "<option value='" + combolist6[i][0] + "' selected>" + combolist6[i][0] + "</option>";
                        } else {
                            cboWitCardTxt = cboWitCardTxt + "<option value='" + combolist6[i][0] + "'>" + combolist6[i][0] + "</option>";
                        }
                    }

                    var combolist7 = data.cboBank;
                    for (var i = 0; i < combolist7.length; i++) {
                        if (combolist7[i][0] == cboBank) {
                            cboBankTxt = cboBankTxt + "<option value='" + combolist7[i][0] + "' selected>" + combolist7[i][1] + "</option>";
                        } else {
                            cboBankTxt = cboBankTxt + "<option value='" + combolist7[i][0] + "'>" + combolist7[i][1] + "</option>";
                        }
                    }

                    $("#cboWitCust").append(cboWitCustTxt);
                    $("#cboWitGbn").append(cboWitGbnTxt);
                    $("#cboWitMethod").append(cboWitMethodTxt);
                    $("#cboAdminCode").append(cboAdminCodeTxt);
                    $("#cboWitActNum").append(cboWitActNumTxt);
                    $("#cboWitCard").append(cboWitCardTxt);
                    $("#cboBank").append(cboBankTxt);
                }
            })



            var sDate = document.getElementById('inputStrDate').value;
            var eDate = document.getElementById('inputEndDate').value;
            var cboCust = document.getElementById('inputCust').value;
            var cboAct = document.getElementById('inputAct').value;

            var strDate = sDate.replace(/\-/g, '')
            var endDate = eDate.replace(/\-/g, '')

            let data = {"strDate": strDate, "endDate": endDate, "cboCust": cboCust, "cboAct": cboAct}

            $.ajax({
                type: "post",
                data: data,
                url: '{% url "receivePay_search" %}',
                headers: {
                    'X-CSRFTOKEN': '{{ csrf_token }}'
                },
                dataType: 'json',
                success: function (data) {
                    var list = data.mainList;
                    var list2 = data.balList;
                    var outTotal = data.outresult;
                    var inTotal = data.inresult;
                    var total = 0;


                    $("#withMainTb").html("");
                    {# 잔액 계산 #}
                    total = (parseInt(list2) - parseInt(outTotal)) + parseInt(inTotal)

                    for (var i = 0; i < list2.length; i++) {

                        $("#withMainTb").append(
                            "<tr id='#withMainTr' class='withMainTr_tr'>" +
                            "<td hidden class='text-center p-1' style='font-size: 0.85rem'></td>" +
                            "<td class='text-center p-1' style='font-size: 0.85rem'></td>" +
                            "<td class='text-center p-1' style='font-size: 0.85rem'>잔 액</td>" +
                            "<td class='text-start p-1' style='font-size: 0.85rem'></td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'></td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'></td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'></td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'></td> " +
                            "<td class='text-end p-1' style='font-size: 0.85rem'></td> " +
                            "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(total) + "</td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'></td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'></td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'></td> " +
                            "</tr> ");
                    }

                    for (var i = 0; i < list.length; i++) {

                        {# 입금 #}
                        if (list[i][0] == '2') {
                            total += list[i][2]
                        }
                        {# 출금 #}
                        if (list[i][0] == '1') {
                            total -= list[i][3]
                        }

                        var check = "";
                        if(list[i][9] == 'Y'){
                            check = '승인';
                        }
                        else{
                            check = '미승인';
                        }

                        if(list[i][9] == 'Y'){
                            $("#withMainTb").append(
                                "<tr id='#withMainTr' class='withMainTr_tr' main_code='" + list[i][0] + "," + list[i][1] + "," + list[i][6] + "," + list[i][4] + "," + list[i][8] + "," + list[i][12] + "'>" +
                                "<td hidden class='text-center p-1' style='font-size: 0.85rem'>" + list[i][0] + "</td>" +
                                "<td class='text-center p-1' style='font-size: 0.8rem'><input disabled class='' type='checkbox' id='chkWith[]' name='chkWith[]' value='" + list[i][0] + "," + list[i][1] + "," + list[i][6] + "," + list[i][4] + "," + list[i][8] + "," + list[i][12] + "'/></td>" +
                                "<td class='text-center p-1' style='font-size: 0.85rem'>" + list[i][1].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3') + "</td>" +
                                "<td class='text-start p-1' style='font-size: 0.85rem'>" + list[i][10] + "</td> " +
                                "<td class='text-start p-1' style='font-size: 0.85rem'>" + list[i][14] + "</td> " +
                                "<td class='text-start p-1' style='font-size: 0.85rem'>" + list[i][16] + "</td> " +
                                "<td class='text-start p-1' style='font-size: 0.85rem'>" + list[i][5] + "</td> " +
                                "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(list[i][2]) + "</td> " +
                                "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(list[i][3]) + "</td> " +
                                "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(total) + "</td> " +
                                "<td class='text-start p-1' style='font-size: 0.85rem'>" + list[i][7] + "</td> " +
                                "<td class='text-start p-1' style='font-size: 0.85rem'></td> " +
                                "<td class='text-start p-1' style='font-size: 0.85rem'>" + check + "</td> " +
                                "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][12] + "</td> " +
                                "</tr> ");
                        }
                        else{
                            $("#withMainTb").append(
                                "<tr id='#withMainTr' class='withMainTr_tr' main_code='" + list[i][0] + "," + list[i][1] + "," + list[i][6] + "," + list[i][4] + "," + list[i][8] + "," + list[i][12] + "'>" +
                                "<td hidden class='text-center p-1' style='font-size: 0.85rem'>" + list[i][0] + "</td>" +
                                "<td class='text-center p-1' style='font-size: 0.8rem'><input class='' type='checkbox' id='chkWith[]' name='chkWith[]' value='" + list[i][0] + "," + list[i][1] + "," + list[i][6] + "," + list[i][4] + "," + list[i][8] + "," + list[i][12] + "'/></td>" +
                                "<td class='text-center p-1' style='font-size: 0.85rem'>" + list[i][1].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3') + "</td>" +
                                "<td class='text-start p-1' style='font-size: 0.85rem'>" + list[i][10] + "</td> " +
                                "<td class='text-start p-1' style='font-size: 0.85rem'>" + list[i][14] + "</td> " +
                                "<td class='text-start p-1' style='font-size: 0.85rem'>" + list[i][16] + "</td> " +
                                "<td class='text-start p-1' style='font-size: 0.85rem'>" + list[i][5] + "</td> " +
                                "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(list[i][2]) + "</td> " +
                                "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(list[i][3]) + "</td> " +
                                "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(total) + "</td> " +
                                "<td class='text-start p-1' style='font-size: 0.85rem'>" + list[i][7] + "</td> " +
                                "<td class='text-start p-1' style='font-size: 0.85rem'></td> " +
                                "<td class='text-start p-1' style='font-size: 0.85rem'>" + check + "</td> " +
                                "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][12] + "</td> " +
                                "</tr> ");
                        }
                    }

                    total = addComma(total)
                    document.getElementById("inputBal").value = total;

                    var combolist = data.cboCust;
                    for (var i = 0; i < combolist.length; i++) {
                        if (combolist[i][0] == cboCust) {
                            cboCustTxt = cboCustTxt + "<option value='" + combolist[i][0] + "' selected>" + combolist[i][1] + "</option>";
                        } else {
                            cboCustTxt = cboCustTxt + "<option value='" + combolist[i][0] + "'>" + combolist[i][1] + "</option>";
                        }
                    }

                    var combolist2 = data.cboAct;
                    for (var i = 0; i < combolist2.length; i++) {
                        if (combolist2[i][0] == cboAct) {
                            cboActTxt = cboActTxt + "<option value='" + combolist2[i][0] + "' selected>" + combolist2[i][0] + "</option>";
                        } else {
                            cboActTxt = cboActTxt + "<option value='" + combolist2[i][0] + "'>" + combolist2[i][0] + "</option>";
                        }
                    }
                    $("#inputCust").append(cboCustTxt);
                    $("#inputAct").append(cboActTxt);


                }
            });
        });

        {# 조회 버튼 누를시 #}
        $(document).on('click', '#btnSearch', function () {
            var sDate = document.getElementById('inputStrDate').value;
            var eDate = document.getElementById('inputEndDate').value;
            var cboCust = document.getElementById('inputCust').value;
            var cboAct = document.getElementById('inputAct').value;

            var strDate = sDate.replace(/\-/g, '')
            var endDate = eDate.replace(/\-/g, '')

            let data = {"strDate": strDate, "endDate": endDate, "cboCust": cboCust, "cboAct": cboAct}

            $.ajax({
                type: "post",
                data: data,
                url: '{% url "receivePay_search" %}',
                headers: {
                    'X-CSRFTOKEN': '{{ csrf_token }}'
                },
                dataType: 'json',
                success: function (data) {
                    var list = data.mainList;
                    var list2 = data.balList;
                    var outTotal = data.outresult;
                    var inTotal = data.inresult;
                    var total = 0;

                    $("#withMainTb").html("");
                    {# 잔액 계산 #}
                    total = (parseInt(list2) - parseInt(outTotal)) + parseInt(inTotal)

                    for (var i = 0; i < list2.length; i++) {

                        $("#withMainTb").append(
                            "<tr id='#withMainTr' class='withMainTr_tr'>" +
                            "<td hidden class='text-center p-1' style='font-size: 0.85rem'></td>" +
                            "<td class='text-center p-1' style='font-size: 0.85rem'></td>" +
                            "<td class='text-center p-1' style='font-size: 0.85rem'>잔 액</td>" +
                            "<td class='text-start p-1' style='font-size: 0.85rem'></td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'></td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'></td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'></td> " +
                            "<td class='text-end p-1' style='font-size: 0.85rem'></td> " +
                            "<td class='text-end p-1' style='font-size: 0.85rem'></td> " +
                            "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(total) + "</td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'></td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'></td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'></td> " +
                            "</tr> ");
                    }

                    for (var i = 0; i < list.length; i++) {

                        {# 입금 #}
                        if(list[i][0] == '2'){
                            total += list[i][2]
                        }
                        {# 출금 #}
                        if(list[i][0] == '1'){
                            total -= list[i][3]
                        }

                        var check = "";
                        if(list[i][9] == 'Y'){
                            check = '승인';
                        }
                        else{
                            check = '미승인';
                        }

                        $("#withMainTb").append(
                            "<tr id='#withMainTr' class='withMainTr_tr' main_code='" + list[i][0] + "," + list[i][1] + "," + list[i][6] + "," + list[i][4] + "," + list[i][8] + "," + list[i][12] + "'>" +
                            "<td hidden class='text-center p-1' style='font-size: 0.85rem'>" + list[i][0] + "</td>" +
                            "<td class='text-center p-1' style='font-size: 0.8rem'><input class='' type='checkbox' id='chkWith[]' name='chkWith[]' value='" + list[i][0] + "," + list[i][1] + "," + list[i][6] + "," + list[i][4] + "," + list[i][8] + "," + list[i][12] + "'/></td>" +
                            "<td class='text-center p-1' style='font-size: 0.85rem'>" + list[i][1].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3') + "</td>" +
                            "<td class='text-start p-1' style='font-size: 0.85rem'>" + list[i][10] + "</td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'>" + list[i][14] + "</td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'>" + list[i][16] + "</td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'>" + list[i][5] + "</td> " +
                            "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(list[i][2]) + "</td> " +
                            "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(list[i][3]) + "</td> " +
                            "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(total) + "</td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'>" + list[i][7] + "</td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'></td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'>" + check + "</td> " +
                            "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][12] + "</td> " +
                            "</tr> ");
                    }

                }
            })
        });


        {# 파일 선택 버튼 클릭시 #}
        $(document).on('click', '#btnFile', function () {
            $("#file").click();
        });

        {# 파일 보기 버튼 클릭시 #}
        $(document).on('click', '#btnFileLook', function () {
            var ioDate = $("#txtWitRegDate").val();
            var acSeqn = $("#txtWitSeq").val();
            var acIogb = $("#cboWitGbn").val();
            var acCust = $("#cboWitCust").val();

            location.href = "{% url 'download_file' %}?ioDate=" + ioDate + "&acSeqn=" + acSeqn + "&acIogb=" + acIogb + "&acCust=" + acCust;
        });

        $(document).on('change', '#file', function () {
            let selectedFile = $(this).prop('files')[0];
            if (selectedFile != null) {
                $('#file_name').text(selectedFile.name);
            }
        });

        {# 테이블 로우 클릭 시 #}
        $(document).on('click', '#withMainTb .withMainTr_tr', function () {

            var itemimg = "";
            var Rfilename = ""
            var imglc = ""
            var cboWitCust2 = "";
            var cboWitGbn = "";
            var cboAdminCode = "";
            var cboWitMethod = "";
            var cboWitActNum = "";
            var cboWitCard = "";
            var cboBank = "";

            var folder = "";
            var permit = "";
            var cboWitCustTxt = "<option value=''>:: 선택 ::</option>";
            var cboWitGbnTxt = "<option value=''>:: 선택 ::</option>";
            var cboAdminCodeTxt = "<option value=''>:: 선택 ::</option>";
            var cboWitMethodTxt = "<option value=''>:: 선택 ::</option>";
            var cboWitActNumTxt = "<option value=''>:: 선택 ::</option>";
            var cboWitCardTxt = "<option value=''>:: 선택 ::</option>";
            var cboBankTxt = "<option value=''>:: 선택 ::</option>";

            $("#cboWitCust").html("");
            $("#cboWitGbn").html("");
            $("#cboAdminCode").html("");
            $("#cboWitMethod").html("");
            $("#cboWitActNum").html("");
            $("#cboWitCard").html("");
            $("#cboBank").html("");
            $("#txtWitRegDate").val("");
            $("#txtWitSeq").val("");
            $("#txtWitRecn").val("");
            $("#txtWitPrice").val("");
            $("#txtWitCashNum").val("");
            $("#txtWitRemark").val("");

            let search = $(this).attr('main_code');
            var split = search.split(',');
            var acIogb = split[0]
            var ioDate = split[1]
            var acNum = split[2]
            var acCust = split[3]
            var acMcode= split[4]
            var acSeqn= split[5]
            var cboGbn = "";


            let data = {'acIogb': acIogb, 'ioDate': ioDate, 'acNum': acNum, "acCust": acCust, 'acMcode': acMcode, "cboGbn": cboGbn, "acSeqn": acSeqn}

            $.ajax({
                type: "post",
                data: data,
                url: '{% url "payment_search" %}',
                headers: {
                    'X-CSRFTOKEN': '{{ csrf_token }}'
                },
                dataType: 'json',
                success: function (data) {
                    var list = data.subList;

                    $("#withSubTb").html("");
                    for (var i = 0; i < list.length; i++) {
                        permit = list[i][23]
                        if(permit == 'Y'){
                            alert('수정 불가능한 건입니다. ')

                            $("#txtWitSeq").val("")
                            $("#txtWitRecn").val("")
                            $("#txtWitRegDate").val("")
                            $("#txtExDate").val("")
                            $("#txtWitPrice").val("")
                            $("#txtWitCashNum").val("")
                            $("#txtWitRemark").val("")
                            $("#txtTitle").val("")
                            $("#txtInfo").val("")
                        }
                        else{

                            $("#txtWitSeq").val(list[i][0])
                            $("#txtWitRecn").val(list[i][3])
                            $("#txtWitRegDate").val(list[i][11].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3'))
                            $("#txtExDate").val(list[i][20].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3'))
                            $("#txtWitPrice").val(addComma(list[i][10]))
                            $("#txtWitCashNum").val(list[i][15])
                            $("#txtWitRemark").val(list[i][19])
                            $("#txtTitle").val(list[i][21])
                            $("#txtWhere").val(list[i][24])
                            $("#txtInfo").val(list[i][25])
                            folder = list[i][22]
                            cboWitCust2 = list[i][1];
                            cboWitGbn = list[i][6];
                            cboWitMethod = list[i][4];
                            cboAdminCode = list[i][8];
                            cboWitActNum = list[i][12];
                            cboWitCard = list[i][22];
                            cboBank = list[i][26]

                            var combolist = data.cboCust;
                            for (var i = 0; i < combolist.length; i++) {
                                if (combolist[i][0] == cboWitCust2) {
                                    cboWitCustTxt = cboWitCustTxt + "<option value='" + combolist[i][0] + "' selected>" + combolist[i][1] + "</option>";
                                } else {
                                    cboWitCustTxt = cboWitCustTxt + "<option value='" + combolist[i][0] + "'>" + combolist[i][1] + "</option>";
                                }
                            }

                            var combolist2 = data.cboGgn;
                            for (var i = 0; i < combolist2.length; i++) {
                                if (combolist2[i][0] == cboWitGbn) {
                                    cboWitGbnTxt = cboWitGbnTxt + "<option value='" + combolist2[i][0] + "' selected>" + combolist2[i][1] + "</option>";
                                } else {
                                    cboWitGbnTxt = cboWitGbnTxt + "<option value='" + combolist2[i][0] + "'>" + combolist2[i][1] + "</option>";
                                }
                            }

                            var combolist3 = data.cboPay;
                            for (var i = 0; i < combolist3.length; i++) {
                                if (combolist3[i][0] == cboWitMethod) {
                                    cboWitMethodTxt = cboWitMethodTxt + "<option value='" + combolist3[i][0] + "' selected>" + combolist3[i][1] + "</option>";
                                } else {
                                    cboWitMethodTxt = cboWitMethodTxt + "<option value='" + combolist3[i][0] + "'>" + combolist3[i][1] + "</option>";
                                }
                            }

                            var combolist4 = data.cboMCode;
                            for (var i = 0; i < combolist4.length; i++) {
                                if (combolist4[i][0] == cboAdminCode) {
                                    cboAdminCodeTxt = cboAdminCodeTxt + "<option value='" + combolist4[i][0] + "' selected>" + combolist4[i][1] + "</option>";
                                } else {
                                    cboAdminCodeTxt = cboAdminCodeTxt + "<option value='" + combolist4[i][0] + "'>" + combolist4[i][1] + "</option>";
                                }
                            }

                            var combolist5 = data.cboAcnumber;
                            for (var i = 0; i < combolist5.length; i++) {
                                if (combolist5[i][0] == cboWitActNum) {
                                    cboWitActNumTxt = cboWitActNumTxt + "<option value='" + combolist5[i][0] + "' selected>" + combolist5[i][0] + "</option>";
                                } else {
                                    cboWitActNumTxt = cboWitActNumTxt + "<option value='" + combolist5[i][0] + "'>" + combolist5[i][0] + "</option>";
                                }
                            }

                            var combolist6 = data.cboCard;
                            for (var i = 0; i < combolist6.length; i++) {
                                if (combolist6[i][0] == cboWitCard) {
                                    cboWitCardTxt = cboWitCardTxt + "<option value='" + combolist6[i][0] + "' selected>" + combolist6[i][0] + "</option>";
                                } else {
                                    cboWitCardTxt = cboWitCardTxt + "<option value='" + combolist6[i][0] + "'>" + combolist6[i][0] + "</option>";
                                }
                            }

                            var combolist7 = data.cboBank;
                            for (var i = 0; i < combolist7.length; i++) {
                                if (combolist7[i][0] == cboBank) {
                                    cboBankTxt = cboBankTxt + "<option value='" + combolist7[i][0] + "' selected>" + combolist7[i][1] + "</option>";
                                } else {
                                    cboBankTxt = cboBankTxt + "<option value='" + combolist7[i][0] + "'>" + combolist7[i][1] + "</option>";
                                }
                            }

                            $("#cboWitCust").append(cboWitCustTxt);
                            $("#cboWitGbn").append(cboWitGbnTxt);
                            $("#cboWitMethod").append(cboWitMethodTxt);
                            $("#cboAdminCode").append(cboAdminCodeTxt);
                            $("#cboWitActNum").append(cboWitActNumTxt);
                            $("#cboWitCard").append(cboWitCardTxt);
                            $("#cboBank").append(cboBankTxt);
                        }
                    }

                    $('#signTd').empty();
                    if(permit == 'Y'){}
                    else{
                        var permitList = data.permit;
                        for (var i = 0; i < permitList.length; i++) {
                            var _td = `<td class="text-start p-1 border border-white subEmpNme" id="subEmpNme_${i}" data-code="${permitList[i][1]}" style="font-size: 0.8rem">${permitList[i][2]}</td>`;
                            $('#signTd').append(_td);
                        }
                    }
                }
            })

        });


        {# 결제방법 선택시 계좌명 바인딩 #}
        $('#cboWitMethod').change(function () {

            $("#cboCard").html("");
            $("#cboAct").html("");

            var method = document.getElementById('cboWitMethod').value

            if(method == '3'){
                $('.cboCard').show();
                $('.cboAct').show();
                $('.cboBank').show();
            }
            else{
                $('.cboCard').hide();
                $('.cboBank').show();
                $('.cboAct').show();
            }
        });


        {# 결제방법 선택시 계좌명 바인딩 #}
        $('#cboBank').change(function () {

            var cboWitCard = "";
            var cboWitActNum = "";
            var cboWitActNumTxt = "<option value=''>:: 선택 ::</option>";
            var cboWitCardTxt = "<option value=''>:: 선택 ::</option>";

            $("#cboWitActNum").html("");
            $("#cboWitCard").html("");

            var cboBank = document.getElementById('cboBank').value

            var data = {"cboBank": cboBank}

            $.ajax({
                type: "post",
                url: '{% url "cboAct" %}',
                data: data,
                headers: {
                    'X-CSRFTOKEN': '{{ csrf_token }}'
                },
                dataType: 'json',
                success: function (data) {

                    var combolist = data.cboCard;
                    for (var i = 0; i < combolist.length; i++) {
                        if (combolist[i][0] == cboWitCard) {
                            cboWitCardTxt = cboWitCardTxt + "<option value='" + combolist[i][0] + "' selected>" + combolist[i][0] + "</option>";
                        } else {
                            cboWitCardTxt = cboWitCardTxt + "<option value='" + combolist[i][0] + "'>" + combolist[i][0] + "</option>";
                        }
                    }

                    var combolist5 = data.cboAct;
                    for (var i = 0; i < combolist5.length; i++) {
                        if (combolist5[i][0] == cboWitActNum) {
                            cboWitActNumTxt = cboWitActNumTxt + "<option value='" + combolist5[i][0] + "' selected>" + combolist5[i][0] + "</option>";
                        } else {
                            cboWitActNumTxt = cboWitActNumTxt + "<option value='" + combolist5[i][0] + "'>" + combolist5[i][0] + "</option>";
                        }
                    }

                    $("#cboWitCard").append(cboWitCardTxt);
                    $("#cboWitActNum").append(cboWitActNumTxt);
                }
            });
        });


        $('#cboWitCard').change(function () {

            var cboWitActNum = "";
            var cboWitActNumTxt = "";

            $("#cboWitActNum").html("");

            var card = document.getElementById('cboWitCard').value

            var data = {"card": card}

            $.ajax({
                type: "post",
                url: '{% url "cboAct" %}',
                data: data,
                headers: {
                    'X-CSRFTOKEN': '{{ csrf_token }}'
                },
                dataType: 'json',
                success: function (data) {

                    var combolist = data.cboAct;
                    for (var i = 0; i < combolist.length; i++) {
                        if (combolist[i][0] == cboWitActNum) {
                            cboWitActNumTxt = cboWitActNumTxt + "<option value='" + combolist[i][0] + "' selected>" + combolist[i][0] + "</option>";
                        } else {
                            cboWitActNumTxt = cboWitActNumTxt + "<option value='" + combolist[i][0] + "'>" + combolist[i][0] + "</option>";
                        }
                    }

                    $("#cboWitActNum").append(cboWitActNumTxt);
                }
            });
        });

        {# 입력란 계좌번호 선택시 계좌명 바인딩 #}
        $('#cboWitGbn').change(function () {

            var val = $(this).val();
            if(val == "1" || val == "2") {
                $('.basic').show();
                $('.replace').hide();
                $('.line').show();

                if(val == '2'){$('.cboCard').hide();}

                var cboWitCust2 = "";
                var cboAdminCode = "";
                var cboWitMethod = "";
                var cboWitActNum = "";
                var cboWitCustTxt = "<option value=''>:: 선택 ::</option>";
                var cboAdminCodeTxt = "<option value=''>:: 선택 ::</option>";
                var cboWitMethodTxt = "<option value=''>:: 선택 ::</option>";
                var cboWitActNumTxt = "<option value=''>:: 선택 ::</option>";

                $("#cboWitCust").html("");
                $("#cboAdminCode").html("");
                $("#cboWitMethod").html("");
                $("#cboWitActNum").html("");

                var cboGbn = document.getElementById('cboWitGbn').value

                var acIogb = "";
                var acDate = "";
                var acNum = "";
                var acCust = "";
                var acMcode = "";

                var data = {"cboGbn": cboGbn, 'acIogb': acIogb, 'acDate': acDate, 'acNum': acNum, "acCust": acCust, 'acMcode': acMcode}

                $.ajax({
                    type: "post",
                    url: '{% url "payment_search" %}',
                    data: data,
                    headers: {
                        'X-CSRFTOKEN': '{{ csrf_token }}'
                    },
                    dataType: 'json',
                    success: function (data) {
                        var combolist = data.cboCust;
                        for (var i = 0; i < combolist.length; i++) {
                            if (combolist[i][0] == cboWitCust2) {
                                cboWitCustTxt = cboWitCustTxt + "<option value='" + combolist[i][0] + "' selected>" + combolist[i][1] + "</option>";
                            } else {
                                cboWitCustTxt = cboWitCustTxt + "<option value='" + combolist[i][0] + "'>" + combolist[i][1] + "</option>";
                            }
                        }

                        var combolist3 = data.cboPay;
                        for (var i = 0; i < combolist3.length; i++) {
                            if (combolist3[i][0] == cboWitMethod) {
                                cboWitMethodTxt = cboWitMethodTxt + "<option value='" + combolist3[i][0] + "' selected>" + combolist3[i][1] + "</option>";
                            } else {
                                cboWitMethodTxt = cboWitMethodTxt + "<option value='" + combolist3[i][0] + "'>" + combolist3[i][1] + "</option>";
                            }
                        }

                        var combolist4 = data.cboMCode;
                        for (var i = 0; i < combolist4.length; i++) {
                            if (combolist4[i][0] == cboAdminCode) {
                                cboAdminCodeTxt = cboAdminCodeTxt + "<option value='" + combolist4[i][0] + "' selected>" + combolist4[i][1] + "</option>";
                            } else {
                                cboAdminCodeTxt = cboAdminCodeTxt + "<option value='" + combolist4[i][0] + "'>" + combolist4[i][1] + "</option>";
                            }
                        }

                        var combolist5 = data.cboAcnumber;
                        for (var i = 0; i < combolist5.length; i++) {
                            if (combolist5[i][0] == cboWitActNum) {
                                cboWitActNumTxt = cboWitActNumTxt + "<option value='" + combolist5[i][0] + "' selected>" + combolist5[i][0] + "</option>";
                            } else {
                                cboWitActNumTxt = cboWitActNumTxt + "<option value='" + combolist5[i][0] + "'>" + combolist5[i][0] + "</option>";
                            }
                        }

                        $("#cboWitCust").append(cboWitCustTxt);
                        $("#cboWitMethod").append(cboWitMethodTxt);
                        $("#cboAdminCode").append(cboAdminCodeTxt);
                        $("#cboWitActNum").append(cboWitActNumTxt);
                    }
                })
            } else if(val == "3") {
                $('.replace').show();
                $('.basic').hide();
                $('.line').hide();

                var cboOutAct = "";
                var cboOutBank = "";
                var cboInAct = "";
                var cboInBank = "";
                var cboOutActTxt = "<option value=''>:: 선택 ::</option>";
                var cboOutBankTxt = "<option value=''>:: 선택 ::</option>";
                var cboInActTxt = "<option value=''>:: 선택 ::</option>";
                var cboInBankTxt = "<option value=''>:: 선택 ::</option>";

                $("#cboOutAct").html("");
                $("#cboOutBank").html("");
                $("#cboInAct").html("");
                $("#cboInBank").html("");

                $.ajax({
                    type: "post",
                    url: '{% url "cboAct" %}',
                    headers: {
                        'X-CSRFTOKEN': '{{ csrf_token }}'
                    },
                    dataType: 'json',
                    success: function (data) {
                        var combolist = data.cboAct;
                        for (var i = 0; i < combolist.length; i++) {
                            if (combolist[i][0] == cboOutAct) {
                                cboOutActTxt = cboOutActTxt + "<option value='" + combolist[i][0] + "' selected>" + combolist[i][0] + "</option>";
                            } else {
                                cboOutActTxt = cboOutActTxt + "<option value='" + combolist[i][0] + "'>" + combolist[i][0] + "</option>";
                            }
                        }

                        var combolist2 = data.cboAct;
                        for (var i = 0; i < combolist2.length; i++) {
                            if (combolist2[i][0] == cboInAct) {
                                cboInActTxt = cboInActTxt + "<option value='" + combolist2[i][0] + "' selected>" + combolist2[i][0] + "</option>";
                            } else {
                                cboInActTxt = cboInActTxt + "<option value='" + combolist2[i][0] + "'>" + combolist2[i][0] + "</option>";
                            }
                        }

                        var combolist3 = data.cboBank;
                        for (var i = 0; i < combolist3.length; i++) {
                            if (combolist3[i][0] == cboOutBank) {
                                cboOutBankTxt = cboOutBankTxt + "<option value='" + combolist3[i][0] + "' selected>" + combolist3[i][1] + "</option>";
                            } else {
                                cboOutBankTxt = cboOutBankTxt + "<option value='" + combolist3[i][0] + "'>" + combolist3[i][1] + "</option>";
                            }
                        }

                        var combolist4 = data.cboBank;
                        for (var i = 0; i < combolist4.length; i++) {
                            if (combolist4[i][0] == cboInBank) {
                                cboInBankTxt = cboInBankTxt + "<option value='" + combolist4[i][0] + "' selected>" + combolist4[i][1] + "</option>";
                            } else {
                                cboInBankTxt = cboInBankTxt + "<option value='" + combolist4[i][0] + "'>" + combolist4[i][1] + "</option>";
                            }
                        }

                        $("#cboOutAct").append(cboOutActTxt);
                        $("#cboOutBank").append(cboOutBankTxt);
                        $("#cboInAct").append(cboInActTxt);
                        $("#cboInBank").append(cboInBankTxt);
                    }
                })
            }

        });

        {# 카드 선택시 계좌명 바인딩 #}
        {#$('#cboWitCard').change(function () {#}
        {##}
        {#    var cboWitActNum = "";#}
        {#    var cboWitActNumTxt = "";#}
        {##}
        {#    $("#cboWitActNum").html("");#}
        {##}
        {#    var cboCard = document.getElementById('cboWitCard').value#}
        {#    var cboGbn = "";#}
        {#    var acIogb = "";#}
        {#    var acDate = "";#}
        {#    var acNum = "";#}
        {#    var acCust = "";#}
        {#    var acMcode = "";#}
        {##}
        {#    var data = {"cboGbn": cboGbn, 'acIogb': acIogb, 'acDate': acDate, 'acNum': acNum, "acCust": acCust, 'acMcode': acMcode, 'cboCard': cboCard}#}
        {##}
        {##}
        {#    $.ajax({#}
        {#        type: "post",#}
        {#        url: '{% url "payment_search" %}',#}
        {#        data: data,#}
        {#        headers: {#}
        {#            'X-CSRFTOKEN': '{{ csrf_token }}'#}
        {#        },#}
        {#        dataType: 'json',#}
        {#        success: function (data) {#}
        {##}
        {#            var combolist5 = data.cboActNum;#}
        {#            for (var i = 0; i < combolist5.length; i++) {#}
        {#                if (combolist5[i][0] == cboWitActNum) {#}
        {#                    cboWitActNumTxt = cboWitActNumTxt + "<option value='" + combolist5[i][0] + "' selected>" + combolist5[i][0] + "</option>";#}
        {#                } else {#}
        {#                    cboWitActNumTxt = cboWitActNumTxt + "<option value='" + combolist5[i][0] + "'>" + combolist5[i][0] + "</option>";#}
        {#                }#}
        {#            }#}
        {##}
        {#            $("#cboWitActNum").append(cboWitActNumTxt);#}
        {##}
        {#                var date = "";#}
        {#                var now = new Date;#}
        {#                var yyyymmdd = new Date(now.getFullYear(), now.getMonth()+ 1, 0)#}
        {#                var yyyy = String(yyyymmdd.getFullYear());#}
        {#                var mm = String(yyyymmdd.getMonth()+1);#}
        {#                var nowDD = String(yyyymmdd.getDate());#}
        {#                var dd = String(data.cboCard);#}
        {#                if(dd > nowDD){#}
        {#                    date = yyyy + '-' + mm + '-' + nowDD;#}
        {#                }#}
        {#                else{#}
        {#                    date = yyyy + '-' + mm + '-' + dd;#}
        {#                }#}
        {##}
        {#                document.getElementById('txtExDate').value = date;#}
        {#        }#}
        {#    })#}
        {##}
        {#});#}

        {# 출금 계좌 계좌명 바인딩 #}
        $('#cboOutBank').change(function () {
            var cboOutAct = "";
            var cboOutActTxt = "";

            $("#cboOutAct").html("");

            var cboBank = document.getElementById('cboOutBank').value

            let data = {'cboBank': cboBank}

            $.ajax({
                type: "post",
                data: data,
                url: '{% url "cboAct" %}',
                headers: {
                    'X-CSRFTOKEN': '{{ csrf_token }}'
                },
                dataType: 'json',
                success: function (data) {
                    var combolist = data.cboAct;
                    for (var i = 0; i < combolist.length; i++) {
                        if (combolist[i][0] == cboOutAct) {
                            cboOutActTxt = cboOutActTxt + "<option value='" + combolist[i][0] + "' selected>" + combolist[i][0] + "</option>";
                        } else {
                            cboOutActTxt = cboOutActTxt + "<option value='" + combolist[i][0] + "'>" + combolist[i][0] + "</option>";
                        }
                    }

                    $("#cboOutAct").append(cboOutActTxt);
                }
            })
        });

        {# 입금 계좌 계좌명 바인딩 #}
        $('#cboInBank').change(function () {
            var cboInAct = "";
            var cboInActTxt = "";

            $("#cboInAct").html("");

            var cboBank = document.getElementById('cboInBank').value

            let data = {'cboBank': cboBank}

            $.ajax({
                type: "post",
                data: data,
                url: '{% url "cboAct" %}',
                headers: {
                    'X-CSRFTOKEN': '{{ csrf_token }}'
                },
                dataType: 'json',
                success: function (data) {

                    var combolist2 = data.cboAct;
                    for (var i = 0; i < combolist2.length; i++) {
                        if (combolist2[i][0] == cboInAct) {
                            cboInActTxt = cboInActTxt + "<option value='" + combolist2[i][0] + "' selected>" + combolist2[i][0] + "</option>";
                        } else {
                            cboInActTxt = cboInActTxt + "<option value='" + combolist2[i][0] + "'>" + combolist2[i][0] + "</option>";
                        }
                    }

                    $("#cboInAct").append(cboInActTxt);
                }
            })
        });


        $('#btnImgDlt').click(function() {
            $('#fileNm').empty();
            $('#file').val("");

            var origin_img_url = $('#itemimage').data('origin');
            $('#itemimage').attr('src', origin_img_url);
        });

        //파일선택창에서 이미지 선택 후 확인 누르면 그 동시에 발생하는 이벤트
        $('#file').change(function(event) {
            var file = event.target.files[0]

            $('#fileNm').text(file.name);

            var reader = new FileReader(); //1

            reader.onload = function(e) {
                $('#file').attr('src', e.target.result); //3
            }

            reader.readAsDataURL(file); //2
        });

        {# 저장 버튼 #}
        $(document).on('click', "#btnSave", function () {

            var formData = new FormData($('#dropzone')[0]);

            var cboWitGbn = document.getElementById('cboWitGbn').value
            {#var txtTitle = document.getElementById('txtTitle').value#}
            {#var cboWitCust = document.getElementById('cboWitCust').value#}
            {#var txtWitRegDate = document.getElementById('txtWitRegDate').value#}
            {#var txtExDate = document.getElementById('txtExDate').value#}
            {#var txtWitSeq = document.getElementById('txtWitSeq').value#}
            {#var txtWitRecn = document.getElementById('txtWitRecn').value#}
            {#var cboAdminCode = document.getElementById('cboAdminCode').value#}
            {#var txtWitPrice = document.getElementById('txtWitPrice').value#}
            {#var cboWitActNum = document.getElementById('cboWitActNum').value#}
            {#var cboWitMethod = document.getElementById('cboWitMethod').value#}
            {#var cboWitCard = document.getElementById('cboWitCard').value#}
            {#var txtWitRemark = document.getElementById('txtWitRemark').value#}
            {#var file = document.getElementById('file').value#}

            {# 가로로 펼쳐진 td 갯수만큼 받아서 돌리기 #}
            if(cboWitGbn == '3'){
                {#const subCount = $('#signTd tr').length;#}

                var outAct = document.getElementById('cboOutAct').value
                var inAct = document.getElementById('cboInBank').value
                if(outAct == ''){
                    alert('출금 계좌를 선택해주세요.')
                    return false
                }
                if(inAct == ''){
                    alert('입금 계좌를 선택해주세요.')
                    return false
                }


                var empArr = [];
                for (var i = 0; i < 10; i++) {

                    var empNbr = $('#subEmpNbr_' + i).text();

                    if(empNbr){
                        let data = {
                            'empNbr': empNbr
                        };
                        empArr.push(data);
                    }
                }

                formData.append('empArrList', JSON.stringify(empArr))

                $.ajax({
                    type: "post",
                    data: formData,
                    cache: false,
                    contentType: false,
                    processData: false,
                    dataType: "json",
                    url: '{% url "offSet_save" %}',
                    headers: {
                        'X-CSRFTOKEN': '{{ csrf_token }}'
                    },
                    success: function (data) {
                        if (data.sucYn === 'Y') {
                            alert('저장 되었습니다.')
                            location.href = "{% url 'with_reg_sheet' %}";
                        }
                        else if(data.sucYn === 'N' && data.message == 'same file name exists') {

                            formData.append('fileOverwriteYn', 'Y');

                            $.ajax({
                                type: "post",
                                data: formData,
                                cache: false,
                                contentType: false,
                                processData: false,
                                dataType: "json",
                                url: '{% url "offSet_save" %}',
                                headers: {
                                    'X-CSRFTOKEN': '{{ csrf_token }}'
                                },
                                success: function (data) {
                                    if (data.sucYn === 'Y') {
                                        alert('저장 되었습니다.')
                                        location.href = "{% url 'with_reg_sheet' %}";
                                    }
                                }
                            });

                            {#if(confirm('동일한 파일명이 존재합니다. 덮어쓰시겠습니까?')) {#}
                            {##}
                            {#}#}
                        }
                    }
                });
            }
            else{

                var empArr = [];
                for (var i = 0; i < 10; i++) {

                    var empNbr = $('#subEmpNbr_' + i).text();
                    if(empNbr){
                        let data = {
                            'empNbr': empNbr
                        };
                        empArr.push(data);
                    }
                }


                formData.append('empArrList', JSON.stringify(empArr))

                $.ajax({
                    type: "post",
                    data: formData,
                    cache: false,
                    contentType: false,
                    processData: false,
                    dataType: "json",
                    url: '{% url "payment_save" %}',
                    headers: {
                        'X-CSRFTOKEN': '{{ csrf_token }}'
                    },
                    success: function (data) {
                        if (data.sucYn === 'Y') {
                            alert('저장 되었습니다.')
                            location.href = "{% url 'with_reg_sheet' %}";
                        }
                        else if(data.sucYn === 'N' && data.message == 'same file name exists') {

                            formData.append('fileOverwriteYn', 'Y');
                            $.ajax({
                                type: "post",
                                data: formData,
                                cache: false,
                                contentType: false,
                                processData: false,
                                dataType: "json",
                                url: '{% url "payment_save" %}',
                                headers: {
                                    'X-CSRFTOKEN': '{{ csrf_token }}'
                                },
                                success: function (data) {
                                    if (data.sucYn === 'Y') {
                                        alert('저장 되었습니다.')
                                        location.href = "{% url 'with_reg_sheet' %}";
                                    }
                                }
                            });
                            {#if(confirm('동일한 파일명이 존재합니다. 덮어쓰시겠습니까?')) {#}
                            {##}
                            {#}#}
                        }
                    }
                });
            }

        });


        {# 초기화 버튼 #}
        $(document).on('click', "#btnClear", function () {
            var cboWitCust2 = "";
            var cboWitGbn = "";
            var cboAdminCode = "";
            var cboWitMethod = "";
            var cboWitActNum = "";
            var cboWitCard = "";
            var cboWitCustTxt = "<option value=''>:: 선택 ::</option>";
            var cboWitGbnTxt = "<option value=''>:: 선택 ::</option>";
            var cboAdminCodeTxt = "<option value=''>:: 선택 ::</option>";
            var cboWitMethodTxt = "<option value=''>:: 선택 ::</option>";
            var cboWitActNumTxt = "<option value=''>:: 선택 ::</option>";
            var cboWitCardTxt = "<option value=''>:: 선택 ::</option>";

            $("#cboWitCust").html("");
            $("#cboWitGbn").html("");
            $("#txtTitle").val("");
            $("#cboAdminCode").html("");
            $("#cboWitMethod").html("");
            $("#cboWitActNum").html("");
            $("#cboWitCard").html("");
            $("#cboWitIssueCust").html("");
            $("#txtWitRegDate").val("");
            $("#txtWitSeq").val("");
            $("#txtWitRecn").val("");
            $("#txtWitPrice").val("");
            $("#txtWitCashNum").val("");
            $("#txtWitRemark").val("");
            $("#txtExDate").val("");
            $("#txtInfo").val("");

            cboWitGbn = '1'
            var cboGbn = '1';

            document.getElementById('txtWitRegDate').valueAsDate = new Date
            var acIogb = "";
            var acDate = "";
            var acNum = "";
            var acCust = "";
            var acMcode = "";

            let data = {'acIogb': acIogb, 'acDate': acDate, 'acNum': acNum, "acCust": acCust, 'acMcode': acMcode, "cboGbn": cboGbn}

            $.ajax({
                type: "post",
                data: data,
                url: '{% url "payment_search" %}',
                headers: {
                    'X-CSRFTOKEN': '{{ csrf_token }}'
                },
                dataType: 'json',
                success: function (data) {

                    var combolist = data.cboCust;
                    for (var i = 0; i < combolist.length; i++) {
                        if (combolist[i][0] == cboWitCust2) {
                            cboWitCustTxt = cboWitCustTxt + "<option value='" + combolist[i][0] + "' selected>" + combolist[i][1] + "</option>";
                        } else {
                            cboWitCustTxt = cboWitCustTxt + "<option value='" + combolist[i][0] + "'>" + combolist[i][1] + "</option>";
                        }
                    }

                    var combolist2 = data.cboGgn;
                    for (var i = 0; i < combolist2.length; i++) {
                        if (combolist2[i][0] == cboWitGbn) {
                            cboWitGbnTxt = cboWitGbnTxt + "<option value='" + combolist2[i][0] + "' selected>" + combolist2[i][1] + "</option>";
                        } else {
                            cboWitGbnTxt = cboWitGbnTxt + "<option value='" + combolist2[i][0] + "'>" + combolist2[i][1] + "</option>";
                        }
                    }

                    var combolist3 = data.cboPay;
                    for (var i = 0; i < combolist3.length; i++) {
                        if (combolist3[i][0] == cboWitMethod) {
                            cboWitMethodTxt = cboWitMethodTxt + "<option value='" + combolist3[i][0] + "' selected>" + combolist3[i][1] + "</option>";
                        } else {
                            cboWitMethodTxt = cboWitMethodTxt + "<option value='" + combolist3[i][0] + "'>" + combolist3[i][1] + "</option>";
                        }
                    }

                    var combolist4 = data.cboMCode;
                    for (var i = 0; i < combolist4.length; i++) {
                        if (combolist4[i][0] == cboAdminCode) {
                            cboAdminCodeTxt = cboAdminCodeTxt + "<option value='" + combolist4[i][0] + "' selected>" + combolist4[i][1] + "</option>";
                        } else {
                            cboAdminCodeTxt = cboAdminCodeTxt + "<option value='" + combolist4[i][0] + "'>" + combolist4[i][1] + "</option>";
                        }
                    }

                    var combolist5 = data.cboAcnumber;
                    for (var i = 0; i < combolist5.length; i++) {
                        if (combolist5[i][0] == cboWitActNum) {
                            cboWitActNumTxt = cboWitActNumTxt + "<option value='" + combolist5[i][0] + "' selected>" + combolist5[i][0] + "</option>";
                        } else {
                            cboWitActNumTxt = cboWitActNumTxt + "<option value='" + combolist5[i][0] + "'>" + combolist5[i][0] + "</option>";
                        }
                    }

                    var combolist6 = data.cboCard;
                    for (var i = 0; i < combolist6.length; i++) {
                        if (combolist6[i][0] == cboWitCard) {
                            cboWitCardTxt = cboWitCardTxt + "<option value='" + combolist6[i][0] + "' selected>" + combolist6[i][0] + "</option>";
                        } else {
                            cboWitCardTxt = cboWitCardTxt + "<option value='" + combolist6[i][0] + "'>" + combolist6[i][0] + "</option>";
                        }
                    }

                    $("#cboWitCust").append(cboWitCustTxt);
                    $("#cboWitGbn").append(cboWitGbnTxt);
                    $("#cboWitMethod").append(cboWitMethodTxt);
                    $("#cboAdminCode").append(cboAdminCodeTxt);
                    $("#cboWitActNum").append(cboWitActNumTxt);
                    $("#cboWitCard").append(cboWitCardTxt);

                }
            })
        });

        {#체크한 내용 삭제#}
        $(document).on('click', "#btnDlt", function () {

            var chk_cust_id_arr = [];
            $('input[name="chkWith[]"]:checked').each(function (i) {
                chk_cust_id_arr.push($(this).val());
            })

            //체크가 1개라도 안되있을때
            let chk_count = $("input[name='chkWith[]']").filter(":checked").length;
            if (chk_count < 1) {
                alert('삭제하실 원장을 체크 해주세요.');
                return false;
            }

            //체크 한 거래처 삭제
            var result = confirm("삭제하시겠습니까?")

            if (result) {
                if (chk_cust_id_arr.length > 0)

                    $.ajax({
                        type: "post",
                        async: false,
                        data: {
                            'arrList': JSON.stringify(chk_cust_id_arr),
                        },
                        dataType: "json",
                        url: '{% url "payment_dlt" %}',
                        headers: {
                            'X-CSRFTOKEN': '{{ csrf_token }}'
                        },
                        success: function (data) {
                            location.href = "{% url 'with_reg_sheet' %}";
                        }

                    });
            } else {

            }
        });

        {# 만기일자 앤터시 input으로 이동 #}
        $('input[type="number"]').keydown(function (event) {
            if (event.keyCode === 13) {
                event.preventDefault();
                if (event.currentTarget.id === 'txtWitPrice') {

                var price = document.getElementById('txtWitPrice').value;
                var sDate = document.getElementById('txtWitRegDate').value;
                var date = sDate.replace(/\-/g, '')

                let data = {'price': price, 'date': date}

                $.ajax({
                    type: "post",
                    data: data,
                    url: '{% url "checkLimit" %}',
                    headers: {
                        'X-CSRFTOKEN': '{{ csrf_token }}'
                    },
                    dataType: 'json',
                    success: function (data) {
                        if (data.YN === 'N') {
                            document.getElementById('warning').value = '요청하신 결제 금액이 많습니다.'
                        }
                        else{

                        }
                    }
                })
                }
            }
        });


        {# 엑셀 버튼 누를시 #}
        $(document).on('click', '#btnExcel', function () {
            var mergedTable = $('<table></table>');
            $('#grid').each(function () {
                $(this).find('tr').each(function (row, tr) {
                    var mergedRow = $('<tr></tr>');

                    $(tr).find('th:not(.excel-hidden), td:not(.excel-hidden)').each(function (col, td) {
                        var input = $(td).find('input');
                        var text = input.length > 0 ? input.val() : $(td).text();
                        $('<td>' + text + '</td>').appendTo(mergedRow);
                    });
                    mergedRow.appendTo(mergedTable);
                });
            });
            mergedTable.table2excel({
                name: 'Sheet1',
                filename: '거래처원장.xls',
            });
        });


    </script>

{% endblock %}