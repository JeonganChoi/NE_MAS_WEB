{% extends "layouts/base.html" %}

{% block title %} 결재 관리 {% endblock %}

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}

    <style>
        #mainTb .mainTr_tr.active {
        background-color: lightgoldenrodyellow !important;
    }
    </style>
{% endblock stylesheets %}

{% block content %}
{#         style="background-image: url('/static/assets/img/header-blue-purple.jpg'); background-position: bottom;"#}
    <div class="height-100"
         style="background-image: url('/static/assets/img/header-blue-purple.jpg'); background-position: bottom;"></div>
    <div class="container-fluid py-1 my-2">
        <div class="row mt-n7">
            <div class="col-lg-12">
                <div class="card blur border border-white rounded-2 shadow-xs">
                    <div class="card-body pb-2">
                        <div class="row">
                            <div class="col-lg-6 col-6 text-start">
                                <h4 class="text-dark font-weight-bold"><i class="fas fa-credit-card fas-4 me-3"></i>결재 관리</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12 col-12">
                <div class="card border border-white shadow-xs">
                    <div class="card-header pb-0 mb-0">
                        <div class="row p-0">
                            <div class="col-lg-7 col-7">
                                <table>
                                    <colgroup>
                                        <col width="4%"/>
                                        <col width="16%"/>
                                        <col width="4%"/>
                                        <col width="10%"/>
                                        <col width="4%"/>
                                        <col width="10%"/>
                                        <col width="10%"/>
                                    </colgroup>
                                    <tbody>
                                    <tr>
                                        <td><label style="font-size: 0.85rem; width: 4rem"><i class="fa fa-search me-2"></i>구분</label></td>
                                        <td>
                                            <select class="form-control border border-light rounded-1 text-center p-0" name="inputGbn" id="inputGbn" style="font-size: 0.8rem; height: 2rem; max-width: 8rem">
                                                <option value="3" selected>미승인</option>
                                                <option value="2">승인</option>
                                            </select>
                                        </td>
                                        <td><label style="font-size: 0.85rem; width: 4rem"><i class="fa fa-search me-2"></i>일자</label></td>
                                        <td>
                                            <div class="d-flex">
                                                <input class="form-control border border-light rounded-1 text-center me-2" type="date" name="txtStrDate" id="txtStrDate" value="" style="height: 2rem; max-width: 8rem"/>
                                                <label class="me-2" style="font-size: 0.85rem">-</label>
                                                <input class="form-control border border-light rounded-1 text-center me-2" type="date" name="txtEndDate" id="txtEndDate" value="" style="height: 2rem; max-width: 8rem"/>
                                            </div>
                                        </td>
                                        <td><label style="font-size: 0.85rem; width: 4rem"><i class="fa fa-search me-2"></i>작성자</label></td>
                                        <td>
                                            <div class="d-flex">
                                                <input hidden class="form-control border border-light rounded-1 text-center me-2" type="text" name="txtEmpCode" id="txtEmpCode" value="" style="height: 2rem; max-width: 8rem">
                                                <input class="form-control border border-light rounded-1 text-center me-2" type="text" name="txtEmp" id="txtEmp" value="" style="height: 2rem; max-width: 8rem">
                                            </div>
                                        </td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td><label style="font-size: 0.85rem; width: 4rem"><i class="fa fa-search me-2"></i>거래처/사용처</label></td>
                                        <td>
                                            <div class="d-flex">
                                                <input hidden class="form-control border border-light rounded-1 text-center me-2" type="text" name="txtCustCode" id="txtCustCode" style="height: 2rem; max-width: 12rem">
                                                <input class="form-control border border-light rounded-1 text-center me-2" type="text" name="txtCust" id="txtCust" style="height: 2rem; max-width: 16rem">
                                            </div>
                                        </td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td class="pt-2 text-end"><button id="btnSearch" name="btnSearch" class="btn text-white ps-3 pe-3 pt-2 pb-2" type="button" style="background-color: #0066cc; font-size: 0.8rem"><i class="fa fa-magnifying-glass-plus pe-2"></i>조 회</button></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="col-lg-5 col-5">
                                <div class="row">
                                    <div class="col-8"></div>
                                    <div class="col-4 justify-content-end align-content-end">
                                        <div class="d-flex justify-content-end align-content-end">
                                            <label style="font-size: 0.85rem; width: 4rem"><i class="fa fa-user me-2"></i>결재자</label>
                                            <input readonly class="form-control border border-light rounded-1 text-center me-2" type="text" name="inputEmp" id="inputEmp" value="{{ request.session.USER_NM }}" style="height: 2rem; max-width: 8rem">
                                            <input hidden class="form-control border border-light rounded-1 text-center me-2" type="text" name="empCode" id="empCode" value="{{ request.session.userId }}" style="height: 2rem">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body mt-0 pt-0">
                        <div class="row">
                            <div class="col-lg-7 col-7">
                                <div class="table-responsive-sm height-400 overflow-auto border border-light">
                                  <table class="table mb-0 align-items-center justify-content-center" id="mainTable">
                                      <colgroup>
                                          <col width="2%">
                                          <col width="8%">
                                          <col width="6%">
                                          <col width="15%">
                                          <col width="8%">
                                          <col width="8%">
                                          <col width="8%">
                                          <col width="6%">
                                          <col width="4%">
                                          <col width="4%">
                                          <!--<col width="4%">-->
                                      </colgroup>
                                    <thead class="text-white font-weight-bolder text-center bg-primary" style="position: sticky; top: 0">
                                      <tr>
                                        <th style="font-size: 0.85rem" class="p-1">선택</th>
                                        <th style="font-size: 0.85rem" class="p-1">사용일자</th>
                                        <th style="font-size: 0.85rem" class="p-1">적용년월</th>
                                        <th style="font-size: 0.85rem" class="p-1">제 목</th>
                                        <th style="font-size: 0.85rem" class="p-1">거래처/사용처</th>
                                        <th style="font-size: 0.85rem" class="p-1">입금 금액</th>
                                        <th style="font-size: 0.85rem" class="p-1">출금 금액</th>
                                        <th style="font-size: 0.85rem" class="p-1">작성자</th>
                                        <th style="font-size: 0.85rem" class="p-1">결재</th>
                                        <th style="font-size: 0.85rem" class="p-1">결재자</th>
                                        <!--<th style="font-size: 0.85rem" class="p-1">시행</th>-->
                                      </tr>
                                    </thead>
                                    <tbody id="mainTb">
                                      <tr id="#mainTr" class="mainTr_tr">

                                      </tr>
                                    </tbody>
                                  </table>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-lg-6 col-6"></div>
                                    <div class="col-lg-6 col-6">
                                        <div class="d-flex" style="float: right;">
                                            <label style="font-size: 0.85rem; width: 3rem"><i class="fa fa-server me-2"></i>총</label>
                                            <input readonly class="form-control border border-light rounded-1 text-end me-2" type="text" name="inputCnt" id="inputCnt" style="font-size: 0.8rem; height: 2rem; max-width: 4rem">
                                            <label class="" style="font-size: 0.85rem; width: 1rem">건</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-5 col-5">
                                <div class="form-group mt-2">
                                    <div class="row">
                                        <div class="col-4">
                                            <label class="text-sm text-danger"><i class="far fa-edit me-2"></i>입/출금</label>
                                            <select readonly class="form-control border border-light rounded-1 text-center bg-danger-soft p-1 bg-transparent" name="cboWitGbn" id="cboWitGbn" style="height: 2rem; font-size: 0.8rem"></select>
                                        </div>
                                        <div class="col-4">
                                            <label class="text-sm"><i class="far fa-edit me-2"></i>제 목</label>
                                            <input readonly class="form-control text-start bg-transparent" type="text" id="txtTitle" name="txtTitle" style="height: 2rem; font-size: 0.8rem"/>
                                        </div>
                                        <div class="col-4 colCust">
                                            <label class="text-sm"><i class="far fa-edit me-2"></i>거래처</label>
                                            <select readonly class="form-control border border-light rounded-1 text-center bg-danger-soft p-1 bg-transparent" name="cboWitCust" id="cboWitCust" style="height: 2rem; font-size: 0.8rem"></select>
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-4">
                                            <label class="text-sm"><i class="far fa-calendar me-2"></i>등록 일자</label>
                                            <input readonly class="form-control text-center bg-transparent" type="date" id="txtWitRegDate" name="txtWitRegDate" style="height: 2rem; font-size: 0.8rem"/>
                                        </div>
                                        <div class="col-4">
                                            <label class="text-sm"><i class="fas fa-edit me-2"></i>관리계정</label>
                                            <select readonly class="form-control border border-light rounded-1 text-center p-1 bg-transparent" name="cboAdminCode" id="cboAdminCode" style="height: 2rem; font-size: 0.8rem"></select>
                                        </div>
                                        <div class="col-4">
                                            <label class="text-sm"><i class="fas fa-edit me-2"></i>예정일자</label>
                                            <input readonly class="form-control text-center bg-transparent" type="date" id="txtExDate" name="txtExDate" style="height: 2rem; font-size: 0.8rem"/>
                                        </div>
                                    </div>
                                    <div hidden class="row">
                                        <div  class="col-4">
                                            <input class="form-control text-end" type="number" id="txtWitSeq" name="txtWitSeq"/>
                                            <input class="form-control text-end" type="number" id="txtWitRecn" name="txtWitRecn"/>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-4">
                                            <label class="text-sm"><i class="fas fa-edit me-2"></i>금액</label>
                                            <input readonly class="form-control text-end bg-transparent" type="text" id="txtWitPrice" name="txtWitPrice" style="height: 2rem; font-size: 0.8rem"/>
                                        </div>
                                        <div class="col-4 colAct">
                                            <label class="text-sm"><i class="fas fa-edit me-2"></i>계좌번호</label>
                                            <select readonly class="form-control border border-light rounded-1 text-center p-1 bg-transparent" name="cboWitActNum" id="cboWitActNum" style="height: 2rem; font-size: 0.8rem"></select>
                                        </div>
                                        <div class="col-4">
                                            <label class="text-sm"><i class="fas fa-edit me-2"></i>결제방법</label>
                                            <select readonly class="form-control border border-light rounded-1 text-center p-1 bg-transparent" name="cboWitMethod" id="cboWitMethod" style="height: 2rem; font-size: 0.8rem"></select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-4 colCard">
                                            <label class="text-sm"><i class="fas fa-edit me-2"></i>카드</label>
                                            <select readonly class="form-control border border-light rounded-1 p-1 text-center bg-transparent" name="cboWitCard" id="cboWitCard" style="height: 2rem; font-size: 0.8rem"></select>
                                        </div>
                                        <div class="col-8">
                                            <label class="text-sm"><i class="fas fa-edit me-2"></i>내용</label>
                                            <input readonly class="form-control text-start bg-transparent" type="text" id="txtWitRemark" name="txtWitRemark" style="height: 2rem; font-size: 0.8rem"/>
                                        </div>
                                    </div>
                                    <div hidden class="row">
                                        <div class="col-4">
                                            <label class="text-sm"><i class="fas fa-edit me-2"></i>직원</label>
                                            <input class="form-control text-start bg-transparent" type="text" id="txtEmpNbr" name="txtEmpNbr" value="{{ request.session.userId }}" style="height: 2rem; font-size: 0.8rem"/>
                                        </div>
                                        <div class="col-4">
                                            <label class="text-sm"><i class="fas fa-edit me-2"></i>폴더</label>
                                            <input class="form-control text-start bg-transparent" type="text" id="txtFolder" name="txtFolder" style="height: 2rem; font-size: 0.8rem"/>
                                        </div>
                                        <div class="col-4">
                                            <label class="text-sm"><i class="fas fa-edit me-2"></i>행번</label>
                                            <input class="form-control text-start bg-transparent" type="text" id="txtSeqn" name="txtSeqn" style="height: 2rem; font-size: 0.8rem"/>
                                        </div>
                                    </div>
                                    <div class="row mt-2 mb-0 pb-0">
                                        <div class="col-12 text-start">
                                            <div class="form-group folderArea">
                                                <label class="form-label"><i class="fa fa-image me-2"></i>증빙 서류</label>
                                                <input type="hidden" id="fileListInput" value="[]" />
                                                <div id="fileList">

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <hr class="line"/>
                                    <div class="row mb-0 pb-0">
                                        <div class="col-4 text-start">
                                            <label class="form-label subTbLabel"><i class="fa fa-users-line me-2"></i>결재 라인</label>
                                            <div class="table-responsive-sm overflow-auto m-0">
                                                <table class="table border border-warning mb-0 align-items-center justify-content-center" style="width: 10rem">
                                                    <tbody id="subTb">
                                                    <tr id="#subTr" class="subTr_tr">
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="col-8 text-start">
                                            <div class="form-group buttonLine pt-0 mt-0">
                                                <label class="form-label signLabel"><i class="fa fa-file-signature me-2"></i>결 재</label>
                                                <div class="row px-3 py-2">
                                                    <div class="col-12 text-start">
                                                        <div class="d-flex">
                                                            <button class="btn btn-sm btn-success me-4" id="btnApv" name="btnApv"><i class="fa fa-file-signature fs-6 pe-3"></i>결 재</button>
                                                            <button class="btn btn-sm btn-instagram me-4" id="btnAbt" name="btnAbt"><i class="fa fa-file-signature fs-6 pe-3"></i>전 결</button>
                                                            <button class="btn btn-sm btn-warning" id="btnReturn" name="btnReturn"><i class="fa fa-file-signature fs-6 pe-3"></i>반 려</button>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="text-sm"><i class="fa fa-ban me-2"></i>반려 사유</label>
                                                            <input class="form-control" id="txtReason" name="txtReason" type="text" style="height: 2rem; font-size: 0.85rem"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--<div class="table-responsive-sm overflow-auto mt-5">
                                    <table class="table mb-0 align-items-center justify-content-center">
                                      <tbody id="subTb">
                                        <tr id="#subTr" class="subTr_tr">
                                        </tr>
                                      </tbody>
                                    </table>
                                </div>-->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


{% endblock %}

{% block javascripts %}
    <script>
        //파일선택창에서 이미지 선택 후 확인 누르면 그 동시에 발생하는 파일이벤트
        $('#file').change(function(event) {
            var file = event.target.files[0]

            var reader = new FileReader(); //1

            reader.onload = function(e) {
                $('#itemimage').attr('src', e.target.result); //3
            }

            reader.readAsDataURL(file); //2
        });

        {# 파일 보기 버튼 클릭시 #}
        {#$(document).on('click', '#btnFileLook', function () {#}
        {#    var ioDate = $("#txtWitRegDate").val();#}
        {#    var acSeqn = $("#txtWitSeq").val();#}
        {#    var acIogb = $("#cboWitGbn").val();#}
        {#    var acCust = $("#cboWitCust").val();#}
        {##}
        {#    location.href = "{% url 'download_file' %}?ioDate=" + ioDate + "&acSeqn=" + acSeqn + "&acIogb=" + acIogb + "&acCust=" + acCust;#}
        {#});#}

        function checkOnlyOne(element) {

          const checkboxes
              = document.getElementsByName("chkApv[]");

          checkboxes.forEach((cb) => {
            cb.checked = false;
          })

          element.checked = true;
        }
    </script>

    <script>
        $(document).ready(function () {
            $('.buttonLine').hide();
            $('.subTbLabel').hide();
            $('.folderArea').hide();
            $('.line').hide();
            var gbn = document.getElementById('inputGbn').value
            var date = new Date();
            date.setMonth(date.getMonth() - 3);

            document.getElementById('txtStrDate').valueAsDate = date;
            document.getElementById('txtEndDate').valueAsDate = new Date;

            var ioDate = document.getElementById('txtStrDate').value;
            var endDate = document.getElementById('txtEndDate').value;
            var txtEmp = "";
            var txtCust = "";

            let data = {'gbn': gbn, "ioDate": ioDate, "endDate": endDate, "txtEmp": txtEmp, "txtCust": txtCust}

            $.ajax({
                type: "post",
                data: data,
                url: '{% url "approval_reg_search" %}',
                headers: {
                    'X-CSRFTOKEN': '{{ csrf_token }}'
                },
                dataType: 'json',
                success: function (data) {
                    var list2 = data.subList;
                    var list = data.mainList;
                    var cust = "";
                    var inAmts = 0;
                    var outAmts = 0;
                    var count = 0;
                    var name = "";

                    count = list.length;

                    {# 순번, 입.출금구분, 날짜 #}
                    $("#mainTb").html("");
                    for (var i = 0; i < list.length; i++) {

                        if(list[i][13] != ''){ cust = list[i][14] }
                        if(list[i][15] != ''){ cust = list[i][15]}

                        if(list[i][6] == '1'){
                            outAmts = list[i][2]
                            inAmts = 0
                        }
                        if(list[i][6] == '2'){
                            inAmts = list[i][2]
                            outAmts = 0
                        }
                        if(gbn == '3'){
                            name = '미승인'
                        }
                        if(gbn == '2'){
                            name = '승인'
                        }

                        $("#mainTb").append(
                            "<tr id='#mainTr' class='mainTr_tr' main_code='" + list[i][0] + "," + list[i][5] + "," + list[i][6] + "," + list[i][3] + "'>" +
                            "<td class='text-center p-1'><input onclick='checkOnlyOne(this)' class='' type='checkbox' id='chkApv[]' name='chkApv[]' value='" + list[i][0] + "," + list[i][5] + "," + list[i][6] + "," + list[i][3] + "'/></td>" +
                            "<td class='text-center p-1' style='font-size: 0.85rem'>" + list[i][0].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3') + "</td> " +
                            "<td class='text-center p-1' style='font-size: 0.85rem'>" + list[i][12].replace(/(\d{4})(\d{2})/g, '$1-$2') + "</td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'>" + list[i][1] + "</td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'>" + cust + "</td> " +
                            "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(inAmts) + "</td> " +
                            "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(outAmts) + "</td> " +
                            "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][9] + "</td> " +
                            "<td class='text-center p-1' style='font-size: 0.85rem'>" + list[i][10] + "</td> " +
                            "<td class='text-center p-1' style='font-size: 0.85rem'>" + name + "</td> " +
                            "<td class='text-center p-1' style='font-size: 0.85rem'>" + list[i][16] + "</td> " +
                            "</tr> ");
                    }

                    document.getElementById("inputCnt").value = count;
                    {#$('#mainTable tbody tr td:first-child input[type=checkbox]').trigger('click')#}
                    $('#mainTable tbody tr:first-child td:first-child input[type=checkbox]').trigger('click');



                }
            })

        });

        {#$('#txtCust').change(function () {#}
        {#    if($('#txtCust').val('')){#}
        {#        $('#txtCustCode').val('');#}
        {#    }#}
        {#});#}


        $('input[type="text"]').keydown(function (event) {
            if (event.keyCode === 13) {
                event.preventDefault();
                if (event.currentTarget.id === 'txtCust') {

                    if ($("#txtCust").val().length == 0) {
                        alert("거래처명 한 글자 이상 입력 후 엔터를 쳐주세요.")
                        return false
                    } else {
                        let thisVal = $("#txtCust").val();
                        let gbnVal = '2';
                        let url = '{% url 'popup_cust' %}';
                        openPop(url + '?val=' + thisVal + '&gbnVal=' + gbnVal, '거래처검색창');
                    }

                }
            }
        });


        {# 조회 버튼 #}
        $(document).on('click', "#btnSearch", function () {
            $('.buttonLine').hide();

            var gbn = document.getElementById('inputGbn').value;
            var ioDate = document.getElementById('txtStrDate').value;
            var endDate = document.getElementById('txtEndDate').value;
            var txtEmp = document.getElementById('txtEmp').value;
            var txtCust = document.getElementById('txtCustCode').value;
            var inputCust = document.getElementById('txtCust').value;
            if(txtCust == ''){ txtCust = inputCust }

            let data = {'gbn': gbn, "ioDate": ioDate, "endDate": endDate, "txtEmp": txtEmp, "txtCust": txtCust}

            $.ajax({
                type: "post",
                data: data,
                url: '{% url "approval_reg_search" %}',
                headers: {
                    'X-CSRFTOKEN': '{{ csrf_token }}'
                },
                dataType: 'json',
                success: function (data) {
                    var list2 = data.subList;
                    var list = data.mainList;
                    var cust = "";
                    var inAmts = 0;
                    var outAmts = 0;
                    var count = 0;
                    var name = "";

                    count = list.length;

                    {# 순번, 입.출금구분, 날짜 #}
                    $("#mainTb").html("");
                    for (var i = 0; i < list.length; i++) {

                        if(list[i][13] != ''){ cust = list[i][14] }
                        if(list[i][15] != ''){ cust = list[i][15]}

                        if(list[i][6] == '1'){
                            outAmts = list[i][2]
                            inAmts = 0
                        }
                        if(list[i][6] == '2'){
                            inAmts = list[i][2]
                            outAmts = 0
                        }
                        if(gbn == '3'){
                            name = '미승인'
                        }
                        if(gbn == '2'){
                            name = '승인'
                        }

                        $("#mainTb").append(
                            "<tr id='#mainTr' class='mainTr_tr' main_code='" + list[i][0] + "," + list[i][5] + "," + list[i][6] + "," + list[i][3] + "'>" +
                            "<td class='text-center p-1'><input onclick='checkOnlyOne(this)' class='' type='checkbox' id='chkApv[]' name='chkApv[]' value='" + list[i][0] + "," + list[i][5] + "," + list[i][6] + "," + list[i][3] + "'/></td>" +
                            "<td class='text-center p-1' style='font-size: 0.85rem'>" + list[i][0].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3') + "</td> " +
                            "<td class='text-center p-1' style='font-size: 0.85rem'>" + list[i][12].replace(/(\d{4})(\d{2})/g, '$1-$2') + "</td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'>" + list[i][1] + "</td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'>" + cust + "</td> " +
                            "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(inAmts) + "</td> " +
                            "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(outAmts) + "</td> " +
                            "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][9] + "</td> " +
                            "<td class='text-center p-1' style='font-size: 0.85rem'>" + list[i][10] + "</td> " +
                            "<td class='text-center p-1' style='font-size: 0.85rem'>" + gbn + "</td> " +
                            "<td class='text-center p-1' style='font-size: 0.85rem'>" + list[i][16] + "</td> " +
                            "</tr> ");
                    }

                    document.getElementById("inputCnt").value = count;
                }
            })

        });



        {# 구분 콤보박스 클릭시 #}
        $('#inputGbn').change(function () {

            var empNbr = document.getElementById('inputEmp').value
            var gbn = document.getElementById('inputGbn').value

            var sDate = document.getElementById('txtWitRegDate').value
            var ioDate = sDate.replace(/\-/g, '')

            $("#cboWitCust").html("");
            $("#cboWitGbn").html("");
            $("#cboAdminCode").html("");
            $("#cboWitMethod").html("");
            $("#cboWitActNum").html("");
            $("#txtWitRegDate").val("");
            $("#txtWitSeq").val("");
            $("#txtWitPrice").val("");
            $("#txtWitRemark").val("");
            $("#txtFolder").val("");
            $("#txtSeqn").val("");
            $("#txtTitle").val("");
            $("#txtExDate").val("");
            $("#subTb").html("");
            $('.subTbLabel').hide();
            $('.buttonLine').hide();
            $(this).removeClass('bg-gray-100');

            let data = {'empNbr': empNbr, 'gbn': gbn, 'ioDate': ioDate}

            $.ajax({
                type: "post",
                data: data,
                url: '{% url "approval_reg_search" %}',
                headers: {
                    'X-CSRFTOKEN': '{{ csrf_token }}'
                },
                dataType: 'json',
                success: function (data) {
                    var list = data.mainList;
                    var cust = "";
                    var text = "";
                    var inAmts = 0;
                    var outAmts = 0;

                    $("#mainTb").html("");
                    for (var i = 0; i < list.length; i++) {

                        if(list[i][13] != ''){ cust = list[i][14] }
                        if(list[i][15] != ''){ cust = list[i][15] }

                        if(list[i][6] == '1'){
                            outAmts = list[i][2]
                            inAmts = 0
                        }
                        if(list[i][6] == '2'){
                            inAmts = list[i][2]
                            outAmts = 0
                        }

                        if(gbn == '3'){
                            text = '미승인'
                            $("#mainTb").append(
                            "<tr id='#mainTr' class='mainTr_tr' main_code='" + list[i][0] + "," + list[i][5] + "," + list[i][6] + "," + list[i][3] + "'>" +
                            "<td class='text-center p-1'><div class='form-check text-xs text-center'><input onclick='checkOnlyOne(this)' class='form-check-input' type='checkbox' id='chkApv[]' name='chkApv[]' value='" + list[i][0] + "," + list[i][5] + "," + list[i][6] + "," + list[i][3] + "'/></div></td>" +
                            "<td class='text-center p-1' style='font-size: 0.85rem'>" + list[i][0].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3') + "</td> " +
                            "<td class='text-center p-1' style='font-size: 0.85rem'>" + list[i][12].replace(/(\d{4})(\d{2})/g, '$1-$2') + "</td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'>" + list[i][1] + "</td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'>" + cust + "</td> " +
                            "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(inAmts) + "</td> " +
                            "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(outAmts) + "</td> " +
                            "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][9] + "</td> " +
                            "<td class='text-center p-1' style='font-size: 0.85rem'>" + list[i][10] + "</td> " +
                            "<td class='text-center p-1' style='font-size: 0.85rem'>" + text + "</td> " +
                            "<td class='text-center p-1' style='font-size: 0.85rem'>" + list[i][16] + "</td> " +
                            "</tr> ");
                        }
                        if(gbn == '2'){
                            text = '승인'
                            $("#mainTb").append(
                            "<tr id='#mainTr' class='mainTr_tr' main_code='" + list[i][0] + "," + list[i][5] + "," + list[i][6] + "," + list[i][3] + "'>" +
                            "<td class='text-center p-1'><div class='form-check text-xs text-center'><input onclick='checkOnlyOne(this)' class='form-check-input' type='checkbox' id='chkApv[]' name='chkApv[]' value='" + list[i][0] + "," + list[i][5] + "," + list[i][6] + "," + list[i][3] + "'/></div></td>" +
                            "<td class='text-center p-1' style='font-size: 0.85rem'>" + list[i][0].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3') + "</td> " +
                            "<td class='text-center p-1' style='font-size: 0.85rem'>" + list[i][12].replace(/(\d{4})(\d{2})/g, '$1-$2') + "</td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'>" + list[i][1] + "</td> " +
                            "<td class='text-start p-1' style='font-size: 0.85rem'>" + cust + "</td> " +
                            "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(inAmts) + "</td> " +
                            "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(outAmts) + "</td> " +
                            "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][9] + "</td> " +
                            "<td class='text-center p-1' style='font-size: 0.85rem'>" + list[i][10] + "</td> " +
                            "<td class='text-center p-1' style='font-size: 0.85rem'>" + text + "</td> " +
                            "<td class='text-center p-1' style='font-size: 0.85rem'>" + list[i][16] + "</td> " +
                            "</tr> ");
                        }
                        {#if(gbn == '4'){#}
                        {#    text = '미시행'#}
                        {#    $("#mainTb").append(#}
                        {#    "<tr id='#mainTr' class='mainTr_tr' main_code='" + list[i][0] + "," + list[i][5] + "," + list[i][6] + "," + list[i][3] + "'>" +#}
                        {#    "<td class='text-center p-1'><div class='form-check text-xs text-center'><input class='form-check-input' type='checkbox' id='chkApv[]' name='chkApv[]' value='" + list[i][0] + "," + list[i][5] + "," + list[i][6] + "," + list[i][3] + "'/></div></td>" +#}
                        {#    "<td class='text-center p-1' style='font-size: 0.85rem'>" + list[i][0].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3') + "</td> " +#}
                        {#    "<td class='text-center p-1' style='font-size: 0.85rem'>" + list[i][12].replace(/(\d{4})(\d{2})/g, '$1-$2') + "</td> " +#}
                        {#    "<td class='text-start p-1' style='font-size: 0.85rem'>" + list[i][1] + "</td> " +#}
                        {#    "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(list[i][2]) + "</td> " +#}
                        {#    "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][9] + "</td> " +#}
                        {#    "<td class='text-center p-1' style='font-size: 0.85rem'>" + list[i][10] + "</td> " +#}
                        {#    "<td class='text-center p-1' style='font-size: 0.85rem'></td> " +#}
                        {#    "<td class='text-center p-1' style='font-size: 0.85rem'>" + text + "</td> " +#}
                        {#    "</tr> ");#}
                        {#}#}
                        {#if(gbn == '5'){#}
                        {#    text = '시행'#}
                        {#    $("#mainTb").append(#}
                        {#    "<tr id='#mainTr' class='mainTr_tr' main_code='" + list[i][0] + "," + list[i][5] + "," + list[i][6] + "," + list[i][3] + "'>" +#}
                        {#    "<td class='text-center p-1'><div class='form-check text-xs text-center'><input class='form-check-input' type='checkbox' id='chkApv[]' name='chkApv[]' value='" + list[i][0] + "," + list[i][5] + "," + list[i][6] + "," + list[i][3] + "'/></div></td>" +#}
                        {#    "<td class='text-center p-1' style='font-size: 0.85rem'>" + list[i][0].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3') + "</td> " +#}
                        {#    "<td class='text-center p-1' style='font-size: 0.85rem'>" + list[i][12].replace(/(\d{4})(\d{2})/g, '$1-$2') + "</td> " +#}
                        {#    "<td class='text-start p-1' style='font-size: 0.85rem'>" + list[i][1] + "</td> " +#}
                        {#    "<td class='text-end p-1' style='font-size: 0.85rem'>" + addComma(list[i][2]) + "</td> " +#}
                        {#    "<td hidden class='text-start p-1' style='font-size: 0.85rem'>" + list[i][9] + "</td> " +#}
                        {#    "<td class='text-center p-1' style='font-size: 0.85rem'>" + list[i][10] + "</td> " +#}
                        {#    "<td class='text-center p-1' style='font-size: 0.85rem'></td> " +#}
                        {#    "<td class='text-center p-1' style='font-size: 0.85rem'>" + text + "</td> " +#}
                        {#    "</tr> ");#}
                        {#}#}

                    }
                }
            })
        });

        $(document).on('change', '#mainTable tbody tr td:first-child input[type=checkbox]', function() {

            {#$('#mainTb .mainTr_tr').removeClass('active');#}
            {#$(this).addClass('active');#}

            var cboWitCust2 = "";
            var cboWitGbn = "";
            var cboAdminCode = "";
            var cboWitMethod = "";
            var cboWitActNum = "";
            var cboWitCustTxt = "";
            var cboWitGbnTxt = "";
            var cboAdminCodeTxt = "";
            var cboWitMethodTxt = "";
            var cboWitActNumTxt = "";
            var cboWitCard = "";
            var cboWitCardTxt = "";

            $("#cboWitCust").html("");
            $("#cboWitGbn").html("");
            $("#cboAdminCode").html("");
            $("#cboWitMethod").html("");
            $("#cboWitActNum").html("");
            $("#cboWitCard").html("");
            $("#txtWitRegDate").val("");
            $("#txtWitSeq").val("");
            $("#txtWitPrice").val("");
            $("#txtWitRemark").val("");
            $("#txtFolder").val("");
            $("#txtSeqn").val("");
            $('.subTbLabel').show();

            var chk_cust_id_arr = [];
            if($(this).is(':checked')) {

                {#$('#mainTable body tr').addClass('bg-gray-100');#}
                chk_cust_id_arr.push($(this).val());

                var split = chk_cust_id_arr[0];
                var it = split.split(',');
                var ioDate = it[0]
                var acSeqn = it[1]
                var acIogb = it[2]

                let data = {'ioDate': ioDate, 'acSeqn': acSeqn, 'acIogb': acIogb}

                $.ajax({
                    type: "post",
                    data: data,
                    url: '{% url "approval_sub_search" %}',
                    headers: {
                        'X-CSRFTOKEN': '{{ csrf_token }}'
                    },
                    dataType: 'json',
                    success: function (data) {
                        var list = data.subList;
                        var list2 = data.mainList;

                        $('.buttonLine').show();
                        $('.line').show();

                        for (var i = 0; i < list2.length; i++) {
                            $("#txtWitSeq").val(list2[i][11])
                            $("#txtWitRegDate").val(list2[i][3].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3'))
                            $("#txtExDate").val(list2[i][5].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3'))
                            $("#txtWitPrice").val(addComma(list2[i][6]))
                            $("#txtWitRemark").val(list2[i][10])
                            $("#txtTitle").val(list2[i][1])
                            $("#txtFolder").val(list2[i][12])
                            $("#txtSeqn").val(list2[i][13])
                            cboWitCust2 = list2[i][2];
                            cboWitGbn = list2[i][0];
                            cboWitMethod = list2[i][8];
                            cboAdminCode = list2[i][4];
                            cboWitActNum = list2[i][7];
                            cboWitCard = list2[i][9]
                        }

                        var combolist = data.cboCust;
                        for (var i = 0; i < combolist.length; i++) {
                            if (combolist[i][0] == cboWitCust2) {
                                cboWitCustTxt = cboWitCustTxt + "<option value='" + combolist[i][0] + "' selected>" + combolist[i][1] + "</option>";
                            }
                        }

                        var combolist2 = data.cboGgn;
                        for (var i = 0; i < combolist2.length; i++) {
                            if (combolist2[i][0] == cboWitGbn) {
                                cboWitGbnTxt = cboWitGbnTxt + "<option value='" + combolist2[i][0] + "' selected>" + combolist2[i][1] + "</option>";
                            }
                        }

                        var combolist3 = data.cboPay;
                        for (var i = 0; i < combolist3.length; i++) {
                            if (combolist3[i][0] == cboWitMethod) {
                                cboWitMethodTxt = cboWitMethodTxt + "<option value='" + combolist3[i][0] + "' selected>" + combolist3[i][1] + "</option>";
                            }
                        }

                        var combolist4 = data.cboMCode;
                        for (var i = 0; i < combolist4.length; i++) {
                            if (combolist4[i][0] == cboAdminCode) {
                                cboAdminCodeTxt = cboAdminCodeTxt + "<option value='" + combolist4[i][0] + "' selected>" + combolist4[i][1] + "</option>";
                            }
                        }

                        var combolist5 = data.cboAcnumber;
                        for (var i = 0; i < combolist5.length; i++) {
                            if (combolist5[i][0] == cboWitActNum) {
                                cboWitActNumTxt = cboWitActNumTxt + "<option value='" + combolist5[i][0] + "' selected>" + combolist5[i][0] + "</option>";
                            }
                        }

                        var combolist6 = data.cboCard;
                        for (var i = 0; i < combolist6.length; i++) {
                            if (combolist6[i][0] == cboWitCard) {
                                cboWitCardTxt = cboWitCardTxt + "<option value='" + combolist6[i][0] + "' selected>" + combolist6[i][0] + "</option>";
                            }
                        }

                        $("#cboWitCust").append(cboWitCustTxt);
                        $("#cboWitGbn").append(cboWitGbnTxt);
                        $("#cboWitMethod").append(cboWitMethodTxt);
                        $("#cboAdminCode").append(cboAdminCodeTxt);
                        $("#cboWitActNum").append(cboWitActNumTxt);
                        $("#cboWitCard").append(cboWitCardTxt);

                        var empCode = document.getElementById('empCode').value

                        $("#subTb").html("");
                        for (var i = 0; i < list.length; i++) {

                            if(list[i][1] == empCode && list[i][7] == 'Y'){
                                $('.buttonLine').hide();
                            }

                            if(list[i][7] == 'Y'){
                                $("#subTb").append(
                                    "<tr id='#subTr' class='subTr_tr'>" +
                                    "<td class='text-center border border-warning font-weight-bolder text-dark p-1' style='font-size: 0.85rem; background-color: #fbdcd8; max-width: 5rem'>" + list[i][0] + "." + list[i][2] + "</td> " +
                                    "</tr> ");
                            }
                            if(list[i][7] == 'N'){
                                $("#subTb").append(
                                    "<tr id='#subTr' class='subTr_tr'>" +
                                    "<td class='text-center border border-warning bg-white font-weight-bolder text-dark p-1' style='font-size: 0.85rem; max-width: 5rem'>" + list[i][0] + "." + list[i][2] + "</td> " +
                                    "</tr> ");
                            }

                        }
                        $("#subTb").append("<tr id='#subTr' class='subTr_tr'>" + "</tr> ");
                        for (var i = 0; i < list.length; i++) {
                            $("#subTb").append(
                                "<tr id='#subTr' class='subTr_tr'>" +
                                "<td hidden class='text-center p-1' style='font-size: 0.85rem; max-width: 5rem'>" + list[i][0] + "</td> " +
                                "</tr> ");
                        }

                        $('.folderArea').show();
                        // 증빙서류 파일 리스트 세팅
                        if(list2.length > 0) {
                            var fileList = [list2[0][14], list2[0][15], list2[0][16], list2[0][17], list2[0][18]];
                            $('#fileListInput').val(JSON.stringify(fileList));

                            // 뷰어허용 확장자
                            var viewer_allow_ext = ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'pdf', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];

                            $('#fileList').empty();

                            for (var i = 0; i < fileList.length; i++) {
                                if (fileList[i] != '') {

                                    // 파일명
                                    var fileName = fileList[i].split('/')[fileList[i].split('/').length - 1];

                                    // 파일 확장자
                                    var file_ext = fileName.split('.').pop().toLowerCase();

                                    // 뷰어 지원하는 확장자인지 체크
                                    var is_viewer_allow_ext = viewer_allow_ext.indexOf(file_ext) != -1 ? true : false;

                                    var ele =   `<table>
                                                    <tbody>
                                                        <tr class="border border-light border-top-0 border-bottom border-end-0 border-start-0" style="border-width: 20rem;">
                                                            <td class="m-0 p-0 pt-2"><input name="file${i+1}" id="file${i+1}" type="file" class="file" style="display: none;" data-findex="${i+1}" /></td>
                                                            <td class="m-0 p-0 pt-2">
                                                                <!--<a class="btn btn-outline-dark mb-2 btn-sm btnFile" type="button" id="btnFile${i+1}" data-findex="${i+1}">파일 선택</a>-->
                                                                <span id="file_name${i+1}" class="file_name">
                                                                    <a href="${fileList[i]}" class="btn btn-sm btn-white mb-2 text-dark" target="_blank">${fileName}</a>
                                                                </span>
                                                            </td>
                                                            <td class="m-0 p-0 pt-2">${is_viewer_allow_ext ? `<a class="btn btn-outline-primary mb-2 btn-sm btnFileLook" type="button" id="btnFileLook${i+1}" data-uri="${fileList[i]}">파일 보기</a>` : ''}</td>
                                                            <td class="m-0 p-0 pt-2">
                                                                <!--<span class="btnFileDelWrapper${i+1}">
                                                                    <a class="btn btn-outline-danger btn-sm mb-2 btnFileDel" type="button" id="btnFileDel${i+1}" data-findex="${i+1}">선택 취소</a>
                                                                </span>-->
                                                                <input type="hidden" name="file_del_yn${i+1}" id="file_del_yn${i+1}" class="file_del_yn" value="N" />
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>`;
                                    $('#fileList').append(ele);
                                }
                            }
                        }

                        if (cboWitMethod == '1') {
                            $('.colCust').hide();
                            $('.colAct').hide();
                            $('.colCard').hide();
                        } else if (cboWitMethod == '2') {
                            $('.colCust').show();
                            $('.colAct').hide();
                            $('.colCard').hide();
                        } else if (cboWitMethod == '3') {
                            $('.colCust').hide();
                            $('.colAct').show();
                            $('.colCard').show();
                        } else if (cboWitMethod == '4') {
                            $('.colCust').hide();
                            $('.colAct').hide();
                            $('.colCard').hide();
                        }

                    }
                })
            }
            else {

                $("#cboWitCust").html("");
                $("#cboWitGbn").html("");
                $("#cboAdminCode").html("");
                $("#cboWitMethod").html("");
                $("#cboWitActNum").html("");
                $("#txtWitRegDate").val("");
                $("#txtWitSeq").val("");
                $("#txtWitPrice").val("");
                $("#txtWitRemark").val("");
                $("#txtFolder").val("");
                $("#txtSeqn").val("");
                $("#txtTitle").val("");
                $("#txtExDate").val("");
                $("#subTb").html("");
                $('.buttonLine').hide();
                $(this).removeClass('bg-gray-100');
                alert('들어옴')
            }
        });

        // 마우스 오버
        $(document).on('mouseover', '#mainTable tr', function() {
            $(this).addClass('bg-gray-100');
        });

        // 마우스 아웃
        $(document).on('mouseout', '#mainTable tr', function() {
            $(this).removeClass('bg-gray-100');
        });


        {# 테이블 로우 클릭 시 #}
        {#$(document).on('click', '#mainTb .mainTr_tr', function () {#}
        {##}
        {#    var cboWitCust2 = "";#}
        {#    var cboWitGbn = "";#}
        {#    var cboAdminCode = "";#}
        {#    var cboWitMethod = "";#}
        {#    var cboWitActNum = "";#}
        {#    var cboWitCustTxt = "";#}
        {#    var cboWitGbnTxt = "";#}
        {#    var cboAdminCodeTxt = "";#}
        {#    var cboWitMethodTxt = "";#}
        {#    var cboWitActNumTxt = "";#}
        {##}
        {#    $("#cboWitCust").html("");#}
        {#    $("#cboWitGbn").html("");#}
        {#    $("#cboAdminCode").html("");#}
        {#    $("#cboWitMethod").html("");#}
        {#    $("#cboWitActNum").html("");#}
        {#    $("#txtWitRegDate").val("");#}
        {#    $("#txtWitSeq").val("");#}
        {#    $("#txtWitPrice").val("");#}
        {#    $("#txtWitRemark").val("");#}
        {#    $("#txtFolder").val("");#}
        {#    $("#txtSeqn").val("");#}
        {##}
            {#$('#mainTr').removeClass('bg-gray-200')#}
            {#$(this).addClass('bg-gray-200');#}
            {#if() {#}
            {#    $(this).removeClass('bg-gray-200');#}
            {#    $(this).addClass('bg-transparent');#}
            {#} else {#}
            {#    $(this).removeClass('bg-transparent');#}
            {#    $(this).addClass('bg-gray-200');#}
            {#}#}
        {##}
        {#    let serials = $(this).attr('main_code');#}
        {#    var split = serials.split(',');#}
        {#    var ioDate = split[0]#}
        {#    var acSeqn = split[1]#}
        {#    var acIogb = split[2]#}
        {##}
        {#    let data = {'ioDate': ioDate, 'acSeqn': acSeqn, 'acIogb': acIogb}#}
        {##}
        {#    $.ajax({#}
        {#        type: "post",#}
        {#        data: data,#}
        {#        url: '{% url "approval_sub_search" %}',#}
        {#        headers: {#}
        {#            'X-CSRFTOKEN': '{{ csrf_token }}'#}
        {#        },#}
        {#        dataType: 'json',#}
        {#        success: function (data) {#}
        {#            var list = data.subList;#}
        {#            var list2 = data.mainList;#}
        {##}
        {#            $('.buttonLine').show();#}
        {##}
        {#            for (var i = 0; i < list2.length; i++) {#}
        {#                $("#txtWitSeq").val(list2[i][11])#}
        {#                $("#txtWitRegDate").val(list2[i][3].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3'))#}
        {#                $("#txtExDate").val(list2[i][5].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3'))#}
        {#                $("#txtWitPrice").val(addComma(list2[i][6]))#}
        {#                $("#txtWitRemark").val(list2[i][10])#}
        {#                $("#txtTitle").val(list2[i][1])#}
        {#                $("#txtFolder").val(list2[i][12])#}
        {#                $("#txtSeqn").val(list2[i][13])#}
        {#                cboWitCust2 = list2[i][2];#}
        {#                cboWitGbn = list2[i][0];#}
        {#                cboWitMethod = list2[i][8];#}
        {#                cboAdminCode = list2[i][4];#}
        {#                cboWitActNum = list2[i][7];#}
        {#            }#}
        {##}
        {#            var combolist = data.cboCust;#}
        {#            for (var i = 0; i < combolist.length; i++) {#}
        {#                if (combolist[i][0] == cboWitCust2) {#}
        {#                    cboWitCustTxt = cboWitCustTxt + "<option value='" + combolist[i][0] + "' selected>" + combolist[i][1] + "</option>";#}
        {#                }#}
        {#            }#}
        {##}
        {#            var combolist2 = data.cboGgn;#}
        {#            for (var i = 0; i < combolist2.length; i++) {#}
        {#                if (combolist2[i][0] == cboWitGbn) {#}
        {#                    cboWitGbnTxt = cboWitGbnTxt + "<option value='" + combolist2[i][0] + "' selected>" + combolist2[i][1] + "</option>";#}
        {#                }#}
        {#            }#}
        {##}
        {#            var combolist3 = data.cboPay;#}
        {#            for (var i = 0; i < combolist3.length; i++) {#}
        {#                if (combolist3[i][0] == cboWitMethod) {#}
        {#                    cboWitMethodTxt = cboWitMethodTxt + "<option value='" + combolist3[i][0] + "' selected>" + combolist3[i][1] + "</option>";#}
        {#                }#}
        {#            }#}
        {##}
        {#            var combolist4 = data.cboMCode;#}
        {#            for (var i = 0; i < combolist4.length; i++) {#}
        {#                if (combolist4[i][0] == cboAdminCode) {#}
        {#                    cboAdminCodeTxt = cboAdminCodeTxt + "<option value='" + combolist4[i][0] + "' selected>" + combolist4[i][1] + "</option>";#}
        {#                }#}
        {#            }#}
        {##}
        {#            var combolist5 = data.cboAcnumber;#}
        {#            for (var i = 0; i < combolist5.length; i++) {#}
        {#                if (combolist5[i][0] == cboWitActNum) {#}
        {#                    cboWitActNumTxt = cboWitActNumTxt + "<option value='" + combolist5[i][0] + "' selected>" + combolist5[i][0] + "</option>";#}
        {#                }#}
        {#            }#}
        {##}
        {#            $("#cboWitCust").append(cboWitCustTxt);#}
        {#            $("#cboWitGbn").append(cboWitGbnTxt);#}
        {#            $("#cboWitMethod").append(cboWitMethodTxt);#}
        {#            $("#cboAdminCode").append(cboAdminCodeTxt);#}
        {#            $("#cboWitActNum").append(cboWitActNumTxt);#}
        {##}
        {#            var empCode = document.getElementById('empCode').value#}
        {##}
        {#            $("#subTb").html("");#}
        {#            $("#subTb").append("<tr id='#subTr' class='subTr_tr'>" + "</tr> ");#}
        {#            for (var i = 0; i < list.length; i++) {#}
        {#                if(empCode == list[i][1]){#}
        {#                    $("#subTb").append(#}
        {#                        "<td class='text-center rounded-2 border border-warning border-2 bg-light font-weight-bolder text-dark p-1' style='font-size: 0.85rem'>" + list[i][0] + "." + list[i][2] + "</td> ");#}
        {#                }#}
        {#                else{#}
        {#                    $("#subTb").append(#}
        {#                        "<td class='text-center rounded-2 border border-warning border-2 bg-white font-weight-bolder text-dark p-1' style='font-size: 0.85rem'>" + list[i][0] + "." + list[i][2] + "</td> ");#}
        {#                }#}
        {##}
        {#            }#}
        {#            $("#subTb").append("<tr id='#subTr' class='subTr_tr'>" + "</tr> ");#}
        {#            for (var i = 0; i < list.length; i++) {#}
        {#                $("#subTb").append(#}
        {#                    "<td hidden class='text-center p-1' style='font-size: 0.85rem'>" + list[i][0] + "</td> ");#}
        {#            }#}
        {##}
        {##}
        {#            if (cboWitMethod == '1') {#}
        {#                $('.colCust').hide();#}
        {#                $('.colAct').hide();#}
        {#                $('.colCard').hide();#}
        {#            } else if (cboWitMethod == '2') {#}
        {#                $('.colCust').show();#}
        {#                $('.colAct').hide();#}
        {#                $('.colCard').hide();#}
        {#            } else if (cboWitMethod == '3') {#}
        {#                $('.colCust').hide();#}
        {#                $('.colAct').show();#}
        {#                $('.colCard').show();#}
        {#            } else if (cboWitMethod == '4') {#}
        {#                $('.colCust').hide();#}
        {#                $('.colAct').show();#}
        {#                $('.colCard').show();#}
        {#            }#}
        {##}
        {#        }#}
        {#    })#}
        {#});#}

        $(document).on('click', '.btnFileLook', function() {
            // 파일 경로
            var file_uri = $(this).data('uri');

            // 파일 확장자
            var file_ext = file_uri.split('.').pop().toLowerCase();

            // 뷰어허용 확장자
            var viewer_allow_ext = ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'pdf', 'doc', 'docx', 'xls', 'xlsx'];

            // MS뷰어에서 지원하는 확장자
            var ms_viewer_allow_ext = ['doc', 'docx', 'xls', 'xlsx'];

            if(file_uri != ''){

                if(viewer_allow_ext.indexOf(file_ext) == -1){
                    alert('지원하지 않는 파일 형식입니다.');
                    return;
                }

                if(ms_viewer_allow_ext.indexOf(file_ext) != -1){
                    // MS뷰어에서 지원하는 확장자면 뷰어로 열기
                    file_uri = encodeURIComponent(file_uri);
                    window.open("{% url 'file_viewer' %}" + '?file_uri=' + file_uri, "_blank");
                } else {
                    window.open(file_uri, "_blank");
                }
            } else {
                alert('파일이 존재하지 않습니다.');
                return;
            }
        });

    </script>

    <script>
        $(document).on('click', '#btnChoice', function () {

            $("#modalSeq").val("");
            $("#modalEmp").val("");
            $("#modalFolder").val("");

            {#let serials = $(this).attr('sub_code');#}
            {#var split = serials.split(',');#}
            var seq = document.getElementById('txtWitSeq').value
            var empNbr = document.getElementById('txtEmpNbr').value
            var folder = document.getElementById('txtFolder').value
            var acDate = document.getElementById('txtWitRegDate').value
            var acSeqn = document.getElementById('txtSeqn').value
            var acIogb = document.getElementById('cboWitGbn').value

            document.getElementById('modalSeq').value = seq
            document.getElementById('modalEmp').value = empNbr
            document.getElementById('modalFolder').value = folder
            document.getElementById('modalDate').value = acDate
            document.getElementById('modalSeqn').value = acSeqn
            document.getElementById('modalIogb').value = acIogb

            $('#DecisionModal').show();
        });

        {# 결재 버튼 클릭시 #}
        $(document).on('click', '#btnApv', function () {

            var seq = document.getElementById('txtWitSeq').value
            var empNbr = document.getElementById('txtEmpNbr').value
            var folder = document.getElementById('txtFolder').value
            var reason = document.getElementById('txtReason').value
            var ioDate = document.getElementById('txtWitRegDate').value
            var acSeqn = document.getElementById('txtSeqn').value
            var acIogb = document.getElementById('cboWitGbn').value
            var gbn = '1'

            var saveresult = confirm("결재하시겠습니까?")

            if(saveresult == true){
                $.ajax({
                    type: "post",
                    data: {
                        'seq': seq,
                        'empNbr': empNbr,
                        'folder': folder,
                        'reason': reason,
                        'ioDate': ioDate,
                        'acSeqn': acSeqn,
                        'acIogb': acIogb,
                        'gbn': gbn
                    },
                    dataType: "json",
                    url: '{% url "approval_reg_save" %}',
                    headers: {
                        'X-CSRFTOKEN': '{{ csrf_token }}'
                    },
                    success: function (data) {
                        if (data.sucYn === 'Y') {
                            alert('결재 되었습니다.')
                            location.href = "{% url 'approval_reg' %}";
                        }
                    }
                });
            }
            if(saveresult == false){}


            {# 선택된 특정위치에 이미지를 뿌려줘야함. #}
            {#$("#subTb").append(#}
            {#    "<td class='border border-end border-light' style='height: 5vh'><img src='folder' width='100%' height='100%'/></td> ");#}

        });

        {# 전결 버튼 클릭시 #}
        $(document).on('click', '#btnAbt', function () {

            var seq = document.getElementById('txtWitSeq').value
            var empNbr = document.getElementById('txtEmpNbr').value
            var folder = document.getElementById('txtFolder').value
            var reason = document.getElementById('txtReason').value
            var ioDate = document.getElementById('txtWitRegDate').value
            var acSeqn = document.getElementById('txtSeqn').value
            var acIogb = document.getElementById('cboWitGbn').value
            var gbn = '2'

            var saveresult = confirm("전결하시겠습니까?")

            if(saveresult == true){

                $.ajax({
                    type: "post",
                    data: {
                        'seq': seq,
                        'empNbr': empNbr,
                        'folder': folder,
                        'reason': reason,
                        'ioDate': ioDate,
                        'acSeqn': acSeqn,
                        'acIogb': acIogb,
                        'gbn': gbn
                    },
                    dataType: "json",
                    url: '{% url "approval_reg_save" %}',
                    headers: {
                        'X-CSRFTOKEN': '{{ csrf_token }}'
                    },
                    success: function (data) {
                        if (data.sucYn === 'Y') {
                            alert('전결 되었습니다.')
                            location.href = "{% url 'approval_reg' %}";
                        }
                    }
                });
            }
            if(saveresult == false){}

        });

        {# 반려 버튼 클릭시 #}
        $(document).on('click', '#btnReturn', function () {

            var seq = document.getElementById('txtWitSeq').value
            var empNbr = document.getElementById('txtEmpNbr').value
            var folder = document.getElementById('txtFolder').value
            var reason = document.getElementById('txtReason').value
            var ioDate = document.getElementById('txtWitRegDate').value
            var acSeqn = document.getElementById('txtSeqn').value
            var acIogb = document.getElementById('cboWitGbn').value
            var gbn = '3'

            if(reason == ''){
                alert('반려사유를 입력해주세요.')
                return false
            }
            var saveresult = confirm("반려하시겠습니까?")

            if(saveresult == true){
                $.ajax({
                    type: "post",
                    data: {
                        'seq': seq,
                        'empNbr': empNbr,
                        'folder': folder,
                        'reason': reason,
                        'ioDate': ioDate,
                        'acSeqn': acSeqn,
                        'acIogb': acIogb,
                        'gbn': gbn
                    },
                    dataType: "json",
                    url: '{% url "approval_reg_save" %}',
                    headers: {
                        'X-CSRFTOKEN': '{{ csrf_token }}'
                    },
                    success: function (data) {
                        if (data.sucYn === 'Y') {
                            alert('반려 되었습니다.')
                            location.href = "{% url 'approval_reg' %}";
                        }
                    }
                });
            }
            if(saveresult == false){}

        });
    </script>
{% endblock %}
{#    $("#subTb").append("<tr id='#subTr' class='subTr_tr'>" + "</tr> ");#}
{#    for (var i = 0; i < list.length; i++) {#}
{#        $("#subTb").append(#}
{#            "<td class='border' sub_code='" + list[i][0] + "," + list[i][1] + "," + list[i][3] + "," + list[i][4] + "," + list[i][5] + "," + list[i][6] + "' id='btnChoice' data-bs-toggle='modal' data-bs-target='#DecisionModal' style='height: 5vh'></td> ");#}
{#    }#}
